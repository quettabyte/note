---
title: 生命周期钩子函数
date: 2022-10-31 15:20:42
author: cokeice
tags: [JavaScript, React]
categories: 
    - 笔记
    - React框架
index_img: /img/react/react.webp
---

<p align='center'>
<a href="https://www.github.com/Cokeic" target="_blank"><img src="https://img.shields.io/badge/Github-@可乐冰-f3e1e1.svg?style=flat-square&logo=Github&logoColor=181717"></a><a href="https://www.gitee.com/Cokeice" target="_blank"><img src="https://img.shields.io/badge/Gitee-@可乐冰-f3e1e1.svg?style=flat-square&logo=Gitee&logoColor=C71D23"></a><a href="https://cokeice.gitee.io/img/wechat/wx.png" target="_blank"><img src="https://img.shields.io/badge/微信-@LNFeng-f3e1e1.svg?style=flat-square&logo=WeChat"></a>
## 生命周期钩子函数📚

### 👊旧版本

<img src="https://cokeiceimg-1313926630.cos.ap-beijing.myqcloud.com/img/react_shengmingzhouqi1.png" style="width: 600px"/>

1. 初始化阶段: 由ReactDOM.render()触发---初次渲染
                                   
          1. constructor() //构造器函数
          2. componentWillMount() //将要挂载 UNSAFE_
          3. render() //渲染组件
          4. componentDidMount() //挂载完成
          	// ====> 常用:一般在这个钩子中做一些初始化的事，例如：开启定时器、发送网络请求、订阅消息

2. 更新阶段: 由组件内部this.setSate()或父组件render触发
                   

          0. componentWillReceiveProps(nextProps) //只有父组件render会触发 UNSAFE_
          1. shouldComponentUpdate(nextProps, nextState) //是否更新组件，参数：将要更新的props和state
          2. componentWillUpdate() //组件将要更新 UNSAFE_
          3. render() ====> 必须使用的一个
          4. componentDidUpdate(preProps, preState) //组件更新完成，参数：更新前的props和state

3. 卸载组件: 由 `ReactDOM.unmountComponentAtNode()` 触发

   ```
   1. componentWillUnmount() //组件将要卸载 
   	// ====> 常用:一般在这个钩子中做一些收尾的事，例如：关闭定时器、取消订阅消息
   ```

### 🪐新版本

<img src="https://cokeiceimg-1313926630.cos.ap-beijing.myqcloud.com/img/react_shengmingzhouqi2.png" style="width: 600px"/>

新版删除了三个钩子函数新增了两个，但是这两个钩子函数使用频率较低

1. 初始化阶段: 由ReactDOM.render()触发---初次渲染

      ```
      constructor()
      getDerivedStateFromProps 
      render()
      componentDidMount() 
      ```

2. 更新阶段: 由组件内部this.setSate()或父组件重新render触发

      ```
      getDerivedStateFromProps
      shouldComponentUpdate()
      render()
      getSnapshotBeforeUpdate
      componentDidUpdate()
      ```

3. 卸载组件: 由ReactDOM.unmountComponentAtNode()触发

      ```
      componentWillUnmount()
      ```

#### 📌getDerivedStateFromProps

```jsx
```



#### 🎯getSnapshotBeforeUpdate

固定滚动条

```jsx
class NewsList extends React.Component{
    state = {newsArr:[]}
    componentDidMount(){
        setInterval(() => {
            //获取原状态
            const {newsArr} = this.state
            //模拟一条新闻
            const news = '新闻'+ (newsArr.length+1)
            //更新状态
            this.setState({newsArr:[news,...newsArr]})
        }, 1000);
    }

    getSnapshotBeforeUpdate(){
        return this.refs.list.scrollHeight
    }

    componentDidUpdate(preProps,preState,height){
        this.refs.list.scrollTop += this.refs.list.scrollHeight - height
    }

    render(){
        return(
            <div className="list" ref="list">
                {
                    this.state.newsArr.map((n,index)=>{
                        return <div key={index} className="news">{n}</div>
                    })
                }
            </div>
        )
    }
}
```

