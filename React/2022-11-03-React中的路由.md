---
title: Reactä¸­çš„è·¯ç”±
date: 2022-11-03 14:42:14
author: cokeice
tags: [JavaScript, React, react-router]
categories: 
    - ç¬”è®°
    - Reactæ¡†æ¶
index_img: /img/react/react.webp
---

<p align='center'>
<a href="https://www.github.com/Cokeic" target="_blank"><img src="https://img.shields.io/badge/Github-@å¯ä¹å†°-f3e1e1.svg?style=flat-square&logo=Github&logoColor=181717"></a><a href="https://www.gitee.com/Cokeice" target="_blank"><img src="https://img.shields.io/badge/Gitee-@å¯ä¹å†°-f3e1e1.svg?style=flat-square&logo=Gitee&logoColor=C71D23"></a><a href="https://cokeice.gitee.io/img/wechat/wx.png" target="_blank"><img src="https://img.shields.io/badge/å¾®ä¿¡-@LNFeng-f3e1e1.svg?style=flat-square&logo=WeChat"></a>

## å‰ç«¯è·¯ç”±çš„åŸºçŸ³ğŸ“š

```html
<script type="text/javascript" src="https://cdn.bootcss.com/history/4.7.2/history.js"></script>
```

> historyæ˜¯ä¸€ä¸ªæ ˆç»“æ„

**BrowserHistory**

ç›´æ¥ä½¿ç”¨H5æ¨å‡ºçš„historyèº«ä¸Šçš„APIï¼Œä¸€äº›æ—§çš„æµè§ˆå™¨å¯èƒ½ä¸æ”¯æŒ

```js
let history = History.createBrowserHistory()
```

**HashHistory**

hashå€¼ï¼ˆé”šç‚¹ï¼‰ï¼Œå…¼å®¹æ€§æä½³

```js
let history = History.createHashHistory()
```

â›**æ“ä½œï¼š**

```js
history.push("/about") // è·³è½¬åˆ°/about
history.replace("/about") // æ›¿æ¢å½“å‰çš„pathå˜ä¸º/about
history.goBack() // å›é€€
history.goForward() // å‰è¿›
history.listen((location) => {
    // å½“è·¯ç”±è·¯å¾„å‘ç”Ÿå˜åŒ–ï¼Œè§¦å‘è¿™ä¸ªå‡½æ•°
    // ç›‘æµ‹è·¯ç”±çš„å˜åŒ–ï¼Œä»è€Œåšå‡ºé¡µé¢çš„è°ƒæ•´
})
```

**æ€»ç»“Reactä¸­çš„è·¯ç”±**ï¼š

ç‚¹å‡»å¯¼èˆªæ é‡Œçš„å¯¼èˆªæŒ‰é’®ï¼Œå¼•èµ·Historyè®°å½•é‡Œè·¯å¾„çš„å˜åŒ–ï¼Œè¢«å‰ç«¯è·¯ç”±å™¨æ‰€ç›‘æµ‹åˆ°ï¼Œè¿›è¡ŒåŒ¹é…ç»„ä»¶ï¼Œä»è€Œå±•ç¤ºé¡µé¢



## Reactä¸­è·¯ç”±çš„åŸºæœ¬ä½¿ç”¨

```shell
npm install react-router-dom@5
```

```js
import {BrowserRouter,HashRouter,Route,Switch,Redirect,NavLink,Link} from 'react-router-dom'
```

1. æ˜ç¡®å¥½ç•Œé¢ä¸­çš„å¯¼èˆªåŒºã€å±•ç¤ºåŒº

2. å¯¼èˆªåŒºçš„aæ ‡ç­¾æ”¹ä¸ºLinkæ ‡ç­¾

   ```jsx
   <Link to="/xxxxx">Demo</Link>
   ```

3. å±•ç¤ºåŒºå†™Routeæ ‡ç­¾è¿›è¡Œè·¯å¾„çš„åŒ¹é…

   ```jsx
   <Route path='/xxxx' component={Demo}/>
   ```

4. `<App>`çš„æœ€å¤–ä¾§åŒ…è£¹äº†ä¸€ä¸ª`<BrowserRouter>`æˆ–`<HashRouter>`



## è·¯ç”±ç»„ä»¶ä¸ä¸€èˆ¬ç»„ä»¶

1. âœ’å†™æ³•ä¸åŒ

   * ä¸€èˆ¬ç»„ä»¶ 

     ```jsx
     <Demo />
     ```

   * è·¯ç”±ç»„ä»¶ 

     ```jsx
     <Route path="/demo" component={Demo}/>
     ```

2. ğŸ“å­˜æ”¾ä½ç½®ä¸åŒ

   * ä¸€èˆ¬ç»„ä»¶ï¼š`components`
   * è·¯ç”±ç»„ä»¶ï¼š`pages`

3. ğŸ§¬æ¥æ”¶åˆ°çš„propsä¸åŒ

   * ä¸€èˆ¬ç»„ä»¶ï¼šå†™ç»„ä»¶æ ‡ç­¾æ—¶ä¼ é€’äº†ä»€ä¹ˆï¼Œå°±èƒ½æ”¶åˆ°ä»€ä¹ˆ

   * è·¯ç”±ç»„ä»¶ï¼šæ¥æ”¶åˆ°ä¸‰ä¸ªå›ºå®šçš„å±æ€§

     ```
     history:
     	go: Æ’ go(n)
     	goBack: Æ’ goBack()
     	goForward: Æ’ goForward()
     	push: Æ’ push(path, state)
     	replace: Æ’ replace(path, state)
     location:
     	pathname: "/about"
     	search: ""
     	state: undefined
     match:
     	params: {}
     	path: "/about"
     	url: "/about"
     ```

## NavLinkä¸å°è£…NavLink

1. NavLinkå¯ä»¥å®ç°è·¯ç”±é“¾æ¥çš„é«˜äº®ï¼Œé€šè¿‡activeClassNameæŒ‡å®šæ ·å¼å

   ---------ä¸æŒ‡å®šactiveClassNameè¢«é€‰ä¸­åˆ™é»˜è®¤æ·»åŠ `"active"`ç±»å

   ```jsx
   <NavLink activeClassName="on" className="mynav" to="/demo">Demo</NavLink>
   ```

2. âœ‰å°è£…NavLink

   ä½¿ç”¨åœºæ™¯ï¼šå½“æœ‰å¤šä¸ªå¯¼èˆªæŒ‰é’®æ—¶

   ```jsx
   <NavLink activeClassName="on" className="mynav" to="/demo1">Demo1</NavLink>
   <NavLink activeClassName="on" className="mynav" to="/demo2">Demo2</NavLink>
   ...
   <NavLink activeClassName="on" className="mynav" to="/demo3">Demo3</NavLink>
   ```
   
   å› ä¸º `activeClassName` å’Œ `className`ä»£ç å¤ªè¿‡å†—ä½™
   
   **å°è£…**
   
   ```jsx
   exprot default class MyNavLink extends Component{
       render() {
           return (
               <NavLink activeClassName="on" className="mynav" {...this.props}/>
           )
       }
   }
   ```
  
   **ä½¿ç”¨MyNavLink**
   
     ```jsx
    <MyNavLink to="/demo">Demo</MyNavLink>
     ```
   
   **ğŸ’¢æ€»ç»“è¦ç‚¹**
   
   1. MyNavLinkåŒæ ‡ç­¾ä¸­çš„æ–‡æœ¬Demoé€šè¿‡`props`ä¼ åˆ°äº†MyNavLinkç»„ä»¶å®ä¾‹ä¸­ï¼Œé€šè¿‡`this.props.children`å¯ä»¥è·å–åˆ°
   
   2. NavLinkå¦‚æœå†™æˆåŒæ ‡ç­¾
   
      ```jsx
      <NavLink activeClassName="on" className="mynav" {...this.props}>{this.props.children}</NavLink>
      ```
   
   3. NavLinkå¦‚æœå†™æˆå•æ ‡ç­¾å¯ä»¥ç®€å†™
   
      ```jsx
      <NavLink activeClassName="on" className="mynav" {...this.props}/>
      ```

## Switchçš„ä½¿ç”¨

1. é€šå¸¸æƒ…å†µä¸‹ï¼Œpathå’Œcomponentæ˜¯ä¸€ä¸€å¯¹åº”çš„å…³ç³»ã€‚

2. Switchå¯ä»¥æé«˜è·¯ç”±åŒ¹é…æ•ˆç‡(å•ä¸€åŒ¹é…)ã€‚

```jsx
<Switch>
    <Route path="/about" component={About}/>
    <Route path="/home" component={Home}/>
    <Route path="/home" component={Test}/> 
    {/* å¦‚æœæ²¡æœ‰Switchï¼ŒåŒ¹é…åˆ°/homeè¿˜ä¼šç»§ç»­å‘ä¸‹åŒ¹é…ï¼Œå¦‚æœä¸‹é¢çš„è·¯ç”±å¾ˆå¤šï¼Œæ•ˆç‡å°±ä¼šå¾ˆä½ */}
    {/* æœ‰Switchä¸ä¼šåŒ¹é…åˆ°Testç»„ä»¶ */}
</Switch>
```

## è§£å†³å¤šçº§è·¯å¾„åˆ·æ–°é¡µé¢æ ·å¼ä¸¢å¤±çš„é—®é¢˜

1. public/index.html ä¸­ å¼•å…¥æ ·å¼æ—¶ä¸å†™ `./` å†™` /` ï¼ˆå¸¸ç”¨ï¼‰

2. public/index.html ä¸­ å¼•å…¥æ ·å¼æ—¶ä¸å†™ `./` å†™ `%PUBLIC_URL%` ï¼ˆå¸¸ç”¨ï¼‰

3. ä½¿ç”¨`HashRouter`

## è·¯ç”±çš„ä¸¥æ ¼åŒ¹é…ä¸æ¨¡ç³ŠåŒ¹é…

1. é»˜è®¤ä½¿ç”¨çš„æ˜¯æ¨¡ç³ŠåŒ¹é…ï¼ˆç®€å•è®°ï¼šã€è¾“å…¥çš„è·¯å¾„ã€‘å¿…é¡»åŒ…å«è¦ã€åŒ¹é…çš„è·¯å¾„ã€‘ï¼Œä¸”é¡ºåºè¦ä¸€è‡´ï¼‰

2. å¼€å¯ä¸¥æ ¼åŒ¹é…ï¼š

   ```jsx
   <Route exact={true} path="/about" component={About}/>
   ```

3. ä¸¥æ ¼åŒ¹é…ä¸è¦éšä¾¿å¼€å¯ï¼Œéœ€è¦å†å¼€ï¼Œæœ‰äº›æ—¶å€™å¼€å¯ä¼šå¯¼è‡´æ— æ³•ç»§ç»­åŒ¹é…äºŒçº§è·¯ç”±

## Redirectçš„ä½¿ç”¨

1. ä¸€èˆ¬å†™åœ¨æ‰€æœ‰è·¯ç”±æ³¨å†Œçš„æœ€ä¸‹æ–¹ï¼Œå½“æ‰€æœ‰è·¯ç”±éƒ½æ— æ³•åŒ¹é…æ—¶ï¼Œè·³è½¬åˆ°RedirectæŒ‡å®šçš„è·¯ç”±

2. å…·ä½“ç¼–ç ï¼š

   ```jsx
    <Switch>
       <Route path="/about" component={About}/>
       <Route path="/home" component={Home}/>
       <Redirect to="/about"/>
   </Switch>
   ```

## åµŒå¥—è·¯ç”±(å¤šçº§è·¯ç”±)

1. æ³¨å†Œå­è·¯ç”±æ—¶è¦å†™ä¸Šçˆ¶è·¯ç”±çš„pathå€¼

2. è·¯ç”±çš„åŒ¹é…æ˜¯æŒ‰ç…§æ³¨å†Œè·¯ç”±çš„é¡ºåºè¿›è¡Œçš„

```jsx
// çˆ¶è·¯ç”±
<Route path="/home" component={About}/>
// å­è·¯ç”±
<MyNavLink to="/home/message">Message</MyNavLink>
```

## paramsä¼ é€’å‚æ•°

è·¯ç”±é“¾æ¥(æºå¸¦å‚æ•°)

```jsx
<Link to='/demo/test/tom/18'}>è¯¦æƒ…</Link>
```

æ³¨å†Œè·¯ç”±(å£°æ˜æ¥æ”¶)

```jsx
<Route path="/demo/test/:name/:age" component={Test}/>
```

æ¥æ”¶å‚æ•°ï¼š

```jsx
this.props.match.params
```

## searchä¼ é€’å‚æ•°

è·¯ç”±é“¾æ¥(æºå¸¦å‚æ•°)

```jsx
<Link to='/demo/test?name=tom&age=18'}>è¯¦æƒ…</Link>
```

æ³¨å†Œè·¯ç”±(æ— éœ€å£°æ˜ï¼Œæ­£å¸¸æ³¨å†Œå³å¯)

```jsx
<Route path="/demo/test" component={Test}/>
```

æ¥æ”¶å‚æ•°

```jsx
this.props.location.search
```

è§£æå‚æ•°

```js
import qs from 'querystring'

```

å¤‡æ³¨ï¼šè·å–åˆ°çš„searchæ˜¯urlencodedç¼–ç å­—ç¬¦ä¸²ï¼Œéœ€è¦å€ŸåŠ©querystringè§£æ

## stateä¼ é€’å‚æ•°

è·¯ç”±é“¾æ¥(æºå¸¦å‚æ•°)

```jsx
<Link to={{pathname:'/demo/test',state:{name:'tom',age:18}}}>è¯¦æƒ…</Link>
```

æ³¨å†Œè·¯ç”±(æ— éœ€å£°æ˜ï¼Œæ­£å¸¸æ³¨å†Œå³å¯)

```jsx
<Route path="/demo/test" component={Test}/>
```

æ¥æ”¶å‚æ•°ï¼š

```jsx
this.props.location.state
```

å¤‡æ³¨ï¼šåˆ·æ–°ä¹Ÿå¯ä»¥ä¿ç•™ä½å‚æ•°

## ç¼–ç¨‹å¼è·¯ç”±å¯¼èˆª

å€ŸåŠ©`this.prosp.history`å¯¹è±¡ä¸Šçš„APIå¯¹æ“ä½œè·¯ç”±è·³è½¬ã€å‰è¿›ã€åé€€

* -this.prosp.history.push()  è·³è½¬
* -this.prosp.history.replace()  æ›¿æ¢è·³è½¬
* -this.prosp.history.goBack()  åé€€
* -this.prosp.history.goForward()  å‰è¿›
* -this.prosp.history.go(n)  nä¸º2å‰è¿›2ä¸ªè®°å½•ï¼Œnä¸º-1åé€€1ä¸ªè®°å½• 

## withRouter

ğŸ’—ä½œç”¨ï¼šæ™®é€šç»„ä»¶çš„propsé‡Œæ²¡æœ‰`history`ã€`loaction`ã€`match`è¿™ä¸‰ä¸ªå±æ€§ï¼Œæ²¡åŠæ³•å®ç°ç¼–ç¨‹å¼è·¯ç”±å¯¼èˆªï¼Œä½¿ç”¨withRouterå¯ä»¥è®©æ™®é€šç»„ä»¶ä¹Ÿèƒ½å†™ç¼–ç¨‹å¼è·¯ç”±å¯¼èˆª

> withRouterå¯ä»¥åŠ å·¥ä¸€èˆ¬ç»„ä»¶ï¼Œè®©ä¸€èˆ¬ç»„ä»¶å…·å¤‡è·¯ç”±ç»„ä»¶æ‰€ç‰¹æœ‰çš„API
> withRouterçš„è¿”å›å€¼æ˜¯ä¸€ä¸ªæ–°ç»„ä»¶

âœ’ç”¨æ³•ï¼š

```jsx
import {withRouter} from 'react-router-dom'
class Header extends Component {
	back = ()=>{
		this.props.history.goBack()
	}
	forward = ()=>{
		this.props.history.goForward()
	}
	go = ()=>{
		this.props.history.go(-2)
	}
	render() {
		console.log('Headerç»„ä»¶æ”¶åˆ°çš„propsæ˜¯',this.props);
		return (
			<div className="page-header">
				<h2>React Router Demo</h2>
				<button onClick={this.back}>å›é€€</button>&nbsp;
				<button onClick={this.forward}>å‰è¿›</button>&nbsp;
				<button onClick={this.go}>go</button>
			</div>
		)
	}
}
export default withRouter(Header)
```

## BrowserRouterä¸HashRouterçš„åŒºåˆ«

1. åº•å±‚åŸç†ä¸ä¸€æ ·ï¼š
   * BrowserRouterä½¿ç”¨çš„æ˜¯H5çš„history APIï¼Œä¸å…¼å®¹IE9åŠä»¥ä¸‹ç‰ˆæœ¬ã€‚
   * HashRouterä½¿ç”¨çš„æ˜¯URLçš„å“ˆå¸Œå€¼ã€‚
2. pathè¡¨ç°å½¢å¼ä¸ä¸€æ ·
   * BrowserRouterçš„è·¯å¾„ä¸­æ²¡æœ‰#,ä¾‹å¦‚ï¼šlocalhost:3000/demo/test
   * HashRouterçš„è·¯å¾„åŒ…å«#,ä¾‹å¦‚ï¼šlocalhost:3000/#/demo/test

3. åˆ·æ–°åå¯¹è·¯ç”±stateå‚æ•°çš„å½±å“
   * BrowserRouteræ²¡æœ‰ä»»ä½•å½±å“ï¼Œå› ä¸ºstateä¿å­˜åœ¨historyå¯¹è±¡ä¸­ã€‚
   * HashRouteråˆ·æ–°åä¼šå¯¼è‡´è·¯ç”±stateå‚æ•°çš„ä¸¢å¤±ï¼ï¼ï¼

4. å¤‡æ³¨ï¼šHashRouterå¯ä»¥ç”¨äºè§£å†³ä¸€äº›è·¯å¾„é”™è¯¯ç›¸å…³çš„é—®é¢˜ã€‚
