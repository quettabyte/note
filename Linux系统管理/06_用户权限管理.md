## 一、用户管理

### 用户介绍

多用户多任务的操作系统



用户类型： 

​		管理员  root

​		普通用户

​				系统用户

​						保证某应用程序可正常使用、运行

​						不允许其登录系统，为安全性考虑

### 用户相关文件

**1./etc/passwd**

保存用户信息

```
root:x:0:0:root:/root:/bin/bash

格式:
用户名:密码占位符:uid:gid:说明信息:宿主目录:shell

uid 用户ID

		管理员	0
		1----999		系统用户
		1000+				普通用户
		
shell:
		用于向内核翻译命令
		
		/bin/bash
				默认，可正常登录系统，执行命令
		/sbin/nologin
				不允许登录系统，适用于系统用户
```

**1./etc/shadow**

保存用户的密码

```
root:$6$0F/TM54B7XqIB895$p76eNkmuHh8JCXOQtbwLUkXF0Ka1ey.QasqpoXjOnuktKr0ErADMIG1ECHtlz1a10q3KNkUEfxw3U.jjBNfHK/::0:99999:7::: 

$6:sha512(更安全)			$1:MD5
$W			salt(盐)	---->		随机数
$apQf	----->	sha512	随机数 + 密码

0:	最短使用天数，如果为3,必须3天后才能修改密码
99999:	最多使用天数，超过这个时间必须修改密码
7:	99999天到期前7天开始提醒
```

## 二、用户管理操作

### 创建用户

```
# useradd [选项]	用户名

[root@localhost cokeice]# useradd userA
```

**常用选项**

```
1)	-u	 用户ID
[root@localhost cokeice]# useradd -u 2000 userC
```



```
2)	-s 	shell		指定用户的shell

			-M			不创建用户的宿主目录
	
[root@localhost cokeice]# useradd -s /sbin/nologin -M mysql

[root@localhost cokeice]# useradd -u 90 -s /sbin/nologin -M openstack
```



```
3)	-g	基本组

[root@localhost cokeice]# groupadd hdfs
[root@localhost cokeice]# useradd -g hdfs hadoop
```



```
4)	-G	附加组,附加组,附加组

[root@localhost cokeice]# groupadd nginx
[root@localhost cokeice]# groupadd httpd
[root@localhost cokeice]# groupadd tomcat
[root@localhost cokeice]# 
[root@localhost cokeice]# useradd -G nginx,httpd,tomcat www
```



### 切换用户

```
# su - 用户名

[root@localhost cokeice]# su - www
```



### 设置用户密码

```
# passwd [选项]	用户名

// 修改当前用户密码
[root@localhost ~]# passwd 

// 修改指定用户密码
[root@localhost ~]# passwd www
```

**常用选项**

```
1)	-l	锁定用户密码		无法直接登录
2)	-u	解锁用户密码

[root@localhost ~]# passwd -l www
[root@localhost ~]# passwd -u	www
```



```
3)	-e	强制用户密码过期

[root@localhost ~]# passwd -e www
```



### 查看用户ID信息

```
# id 用户名

[root@localhost ~]# id www
```



### 修改用户信息

```
# usermod [选项]	用户名

-u	修改用户ID

[root@localhost ~]# usermod -u 3000 userA

-s	修改用户shell

[root@localhost ~]# usermod -s /sbin/nologin userB

-G	附加组,附加组,附加组

[rootalocalhost ~]id userc
uid=2000(userc)gid=2000(userc)groups=2000(userc)

[root@localhost ~]groupadd caiwu
[rootalocalhost ~]usermod -G caiwu userc

[root@localhost ~]id userc
uid=2000(userc)gid=2000(userc)groups=2000(userc),2008(caiwu)

[rootalocalhost ~]usermod -aG caiwu userc
[rootalocalhost ~]id userc
uid=2000(userc)gid=2000(userc)groups=2000(userc),2008(caiwu),2009(jishu)

-L	锁定用户密码
-U	解锁用户密码
```



### 删除用户

```
# userdel	[选项]	用户名

-r	同时删除用户相关文件
 
```



### 查看用户登录信息

```
[root@localhost ~]# who
root     pts/0        2023-03-08 13:23 (:0)
root     :0           2023-03-08 13:23 (:0)
```



### 查看失败的登录

```
[root@localhost ~]# lastb
```



### 查看所有登录行为

```
[root@localhost ~]# last
```



## 三、用户组管理操作

用户组相关文件

**/etc/group**



### 创建用户组

```
# groupadd	用户组名
```



### 删除用户组

```
# groupdel	用户组名
```



### 从组中删除用户

```
# gpasswd -d user01 tomcat

将user01从tomcat组中移出
```



## 四、用户相关配置文件



每创建一个用户，系统会自动将/etc/skel目录的文件复制到用户家目录

```
# ls -a /home/user06
.	..	.bash_logout .bash_profile	.bashrc
```

### 1) .bash_profile	

**【定义环境变量】**

​		该文件中的命令，会在用户登录系统时自动执行

```
echo '谨慎操作！！！！！'

[root@localhost ~]# su - user01
谨慎操作！！！！！
[user01@localhost ~]$	
```

**全局文件 /etc/profile**

​	针对系统中所有用户生效



### 2) .bashrc

**【定义命令别名】只针对该用户生效**

​		该文件的命令，会在用户打开新终端时自动执行

```
alias cs='cat /etc/sysconfig/network-scripts/ifcfg-ens33'
```

**全局文件 /etc/bashrc**

​		针对系统中所有用户



### 3）.bash_logout

​		会在用户退出的的时候自动执行

### 4） .bash_history

​		用户登录过系统后，才会出现

​		用于记录对应用户的历史命令

```
# history				//查看历史命令
# history -c		//清空历史命令
```



## 五、重置root密码

1、重启系统

2、启动到grub菜单界面，按上下键，暂停启动

3、选择gruab菜单中第一项，按字母e编辑系统启动配置文件

4、找到Linux16开头的行，在行尾添加空格+` rd.break`

5、按ctrl+x再次启动，进入救援模式

6、以读写的方式重新挂载根目录

```
# mount -o rw.remount	/sysroot
```

7、切换到救援模式根目录

```
switch_root# chroot /sysroot
```

8、使用passwd命令重置密码

```
sh-4.2#	passwd root
```

9、创建隐藏文件

```
sh-4.2# touch /.autorelabel
```

10、敲两次exit退出救援模式，系统会正常启动

```

```















