# DataCom HCIA 笔记

## 进制转换

1. 二进制
2. 十进制
3. 十六进制

## IPv4编制

1. 单播*Unicast*:用于点对点转发，目的IP为`A、B、C类`的数据帧称为单播帧，单播ipv4地址代表一个节点或者一个接口。
2. 广播*Broadcast*：用于点到所有，收到广播，必须接收，目的IP为`255.255.255.255`称为广播帧。
3. 组播/多播*Multicast*：用于点对多点，目的IP为`D类`的数据帧称为组播/多播帧，广播是一种特殊的组播。

### 特殊地址

1.  `0.0.0.0`

   未分配，保留，用途：dhcp、ppp交互。

2. `255.255.255.255`

   全网广播，影响面太大。

3. `169.254.0.0/16`

   ipv4链路本地（link-local），RFC3927定义，当dhcp获取不到地址，windows会自动获取169.254.0.0/16

   这个地址只能本链路（局域网）转发，不能穿越路由器。

4. `127.0.0.0/8`

   本地回环地址（localhost），代表本设备。

### 有类地址

```
A类：1.0.0.0 ~ 126.255.255.255
     范围：network.host.host.host
B类：128.0.0.0 ~ 191.255.255.255
     范围：network.network.host.host
C类：192.0.0.0 ~ 223.255.255.255
     范围：network.network.network.host
D类：224.0.0.0 ~ 239.255.255.255
     范围：network.group.group.group
E类：240.0.0.0 ~ 255.255.255.255
     保留，不分配使用
```

存在的问题：有类网络出现的场景在于刚开始ipv4地址没有大规模使用的情况

1.地址浪费。2.网络太大，效率低。3.全部在一个网络，有安全隐患。

### 无类地址

有类地址的问题可以通过subnet子网来解决 —— 隔离网络

**子网掩码**：subnet mask，在二进制表示中，必须连续，不能中断。

意义：标识对应ipv4地址中哪些bit表示网络，哪些表示主机，界定网络的范围

例如：`255.255.0.0`、`255.255.224.0`、`255.255.255.0`

> CIDR：无类域间路由
>
> 1、VLSM：把ipv4网络划小，目的是为了隔离
>
> 2、super 超网（summary）汇总：减少路由条目
>
> 汇总本质：减少路由条目，提高查表的效率，降低资源消耗

**题型**

计算子网网段、子网地址范围、可用地址范围、广播地址

题1：ip address：1.1.1.130，network mask：255.255.255.128

答：网络号（网段）：1.1.1.128，子网地址范围：1.1.1.128 ~ 1.1.1.255，可用地址范围：1.1.1.129 ~ 1.1.1.254，广播地址：1.1.1.255

## Ping通原理

接口或者终端获取到ip地址后，会首先向外发送免费ARP，用于地址冲突检测

免费ARP-Request（target ip为自己的ip），对方收到ARP-Request，检查targetip是否为自己的IP，如果是就是地址冲突，发arp-reply，如果不是证明地址没有冲突，不回应。

<img src="https://lnfeng-pic.oss-cn-wulanchabu.aliyuncs.com/datacom-note/2024-6-16-14-21-44.png" alt="2024-6-16-14-21-44.png" style="zoom: 80%;" />

1. 在AR1中执行`ping 10.10.12.2`。

2. 查询路由表，意义：过滤掉没有必要转发的流量，节省资源。

   ![image-20240616145946742](C:\Users\LNFeng\AppData\Roaming\Typora\typora-user-images\image-20240616145946742.png)

3. 如果有路由就进行封装

   | DATA              | IP-Header                         | MAC-Header                              |
   | ----------------- | --------------------------------- | --------------------------------------- |
   | ICMP echo-request | sip:10.10.12.1； dip:10.10.12.2； | type:0x0806；SMAC:AR1；DMAC:查询ARP表； |

4. 查询ARP表中没有查到10.10.12.2的MAC地址，需要发送ARP请求获取10.10.12.2的MAC地址

5. 封装ARP-Request，发送数据

   | ARP                                                          | MAC-Header                                              |
   | ------------------------------------------------------------ | ------------------------------------------------------- |
   | Sender-mac:AR1；Sender-ip:10.10.12.1；Target-mac: 00:00:00:00:00:00；Target-ip:10.10.12.2； | type:0x0806；SMAC:AR1；DMAC:FF:FF:FF:FF:FF:FF（广播）； |

   > 正常ARP：Target ip为想知道该IP的MAC地址
   >
   > 免费ARP：Target ip为自己本身的IP

6. AR2收到bit流，格式化为以太帧。

7. 读取二层头部


* 如果是广播，dmac FFFFFFFFFFFF，由于IG=1，所以是广播或者组播，读完确定是广播，收

* 如果是组播，dmac 01005e000001，由于IG=1，所以是广播或者组播，读完确定是组播，检查接口是否侦听次组播组，如果侦听就收，如果不侦听，就不收
* 如果是单播，dmac 00005e000002，由于IG=0，所以是单播，读完之后，跟入接口去比较，如果dmac是入接口mac地址，那么收，如果dmac不是入接口mac地址，就不收

8. 如果收，检查type，由于type为0x0806，代表后面是arp的数据，二层头部拆除，提交数据给ARP进程。

9. ARP进程读取arp-request数据

* 读取target ip，检查target ip是否是我自己，如果target ip不是我自己的接口ip，忽略
* 如果target ip是我自己的接口ip，回复arp-reply。
* 查询自己的arp表中是否有sender ip的MAC地址，若没有，则添加到自己的ARP表项中。

10. 封装arp-reply数据

    | ARP                                                          | MAC-Header                                |
    | ------------------------------------------------------------ | ----------------------------------------- |
    | Sender-mac:AR2；Sender-ip:10.10.12.2；Target-mac: AR1；Target-ip:10.10.12.1； | type:0x0806；SMAC:AR2；DMAC:AR1（单播）； |

11. AR1收到bit流，同AR2收到bit流的流程相同，ARP进程读取arp-reply数据，更新ARP条目。

    ![2024-6-16-16-12-04.png](https://lnfeng-pic.oss-cn-wulanchabu.aliyuncs.com/datacom-note/2024-6-16-16-12-04.png)

### 扩展-三层设备转发原理

eg：访问`http://www.baidu.com`

```
1. 查询DNS， www.baidu.com------ipv4地址多少？4.5.6.7
2. 查询路由表： 4.5.6.7的路由
3. 如果有开始封装：
Http| tcp sport X dport 80 | sip 172.16.12.1 dip 4.5.6.7 | smac AR1 dmac ？
4. 查询arp
	查询网关mac地址
	Arp-request 
	Arp-reply
	更新网关mac
5. 数据转发
Http| tcp sport X dport 80 | sip 172.16.12.1 dip 4.5.6.7 | smac AR1 dmac AR2
```

## 网络设备管理

