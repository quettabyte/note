## Kubernetes

### 一、Kubernetes介绍

```
简称k8s
开源、基于go语言开发， 容器集群管理系统/容器编排平台
主要用于自动化部署、扩展和管理容器应用, 提供了资源调度、部署管理、服务发现、扩容缩容、监控等一整套功能
Kubernetes目标是让部署容器化应用简单高效
```

#### 1、Kubernetes功能

```
1、数据卷

    Pod中容器间共享数据, 可以使用数据卷
    Pod是K8s部署的最小单元

2、应用程序健康检查

	容器内服务可能由于进程堵塞无法处理请求，可以设置监控检查策略保证可用性

3、复制应用程序实例

	控制器维护着Pod副本数量，保证一个Pod或一组同类的Pod数量始终可用

4、弹性伸缩

	根据设定的指标(CPU利用率)自动缩放Pod副本数

5、服务发现

	使用环境变量或DNS服务插件保证容器中程序发现Pod入口访问地址

6、负载均衡

	一组Pod副本分配一个私有的集群IP地址，负载均衡转发请求到后端容器。在集群内部其他Pod可通过这个ClusterIP访问应用

7、滚动更新

	更新服务不中断、一次更新一个Pod，而不是同时删除整个服务

8、服务编排

	通过文件描述部署服务， 使得应用程序部署变得更高效

9、资源监控

	Node节点组件集成cAdvisor资源收集工具，可通过Heapster汇总整个集群节点资源数据，然后存储到InfluxDB时序数据库，再由Grafana展示

10、提供认证和授权

	支持角色访问控制(RBAC)认证授权等策略

```



## 二、Kubernetes架构 

![image-20210415095857260](C:\Users\admin\AppData\Roaming\Typora\typora-user-images\image-20210415095857260.png)

```
一、Master组件

	1、Kube-apiserver
		Kubernetes API, 集群的统一入口，各组件协调者, 以HTTP API接口服务所有对象的管理及监听操作都交给APIServer处理后再提交给Etcd存储
		
	2、Kube-controller-manager
		处理集群中常规后台任务，一个资源对应一个控制器, 而ControllerManager就是负责管理这些控制器的
	
	3、Kube-scheduler
		根据调度算法为新建的Pod选择Node节点

二、Node组件

	1、Kubelet
	
		Kubelet是Master在Node节点上的agent, 管理本机运行容器的生命周期. 比如创建容器、Pod挂载数据卷、下载secret, 获取容器和节点状态等工作。kublet将每个Pod转换成一组容器
		
	2、Kube-proxy
		在Node节点实现Pod网络代理, 维护网络规则和四层负载均衡工作
		
	3、docker Engine
		运行容器
		
三、Etcd
	分布式键值存储系统. 用于保存集群状态信息；比如Pod, service等对象信息

```



### 三、核心概念

#### 1、Pod

```
Pod是最小部署单元

一个Pod可以放一个容器、也可以放多个容器

通常一个Pod对应一个容器
```

#### 2、Deploy

```
Deploy	部署
```

#### 3、Service

```
Service一个应用服务抽象, 定义了Pod逻辑集合和访问这个Pod集合的策略
Service代理Pod集合对外表现是为一个访问入口, 分配一个集群Ip地址, 来自这个IP的请求将负载均衡转发后端Pod中的容器

Service通过Lable Selector选择一组Pod提供服务
```

#### 4、volume

```
卷，实现持久存储、数据共享
```

#### 5、Namespace

```
命名空间将对象逻辑上分配到不同的Namespace，可以是不同的项目、用户等区分管理，并设定控制策略，从而实现多租户。

命名空间也称为虚拟集群
```

#### 6、Label

```
标签用于区分对象(Pod, service等), 键值对存在；
每个对象可以有多个标签, 通过标签关联对象
```



### 四、控制器   controller 

#### 1、Replicaset

```
简称RS
确保任何给定时间指定的Pod副本数量
```

#### 2、StatefulSet

```
StatefulSet适合持久性的应用程序, 有唯一的网络标识符(IP), 持久存储、有序的部署、扩展、删除和滚动更新
```

#### 3、DaemonSet

```
DaemonSet确保所有节点运行同一个Pod。当节点加入Kubernetes集群中, Pod会被调度到该节点上运行, 当节点从集群中移除时，DaemonSet会被删除。删除DaemonSet会清理它所有创建的Pod
```

#### 4、Job

```
一次性任务, 运行完成后Pod销毁, 不再重新启动新容器。还可以任务定时运行
```





























