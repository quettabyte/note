## 容器应用

### 一、容器介绍

```
容器	docker
基于GO语言开发 
```

![image-20210412092823320](C:\Users\admin\AppData\Roaming\Typora\typora-user-images\image-20210412092823320.png)

#### 1、与传统虚拟化技术的区别

```
1、所有容器是共享物理机内核的，工作效率高、安全性低 
2、创建速度快，秒级
3、快速构建应用
4、便于业务的迁移，保证运行环境的一致 
```

#### 2、技术角度

```
1、C/S架构
2、借助namespace命令空间、cgroup机制实现
	a) namespace命令空间，实现容器间的资源隔离 
	b) cgroup机制, 实现资源限制(CPU、内存)
3、镜像image 
```



### 二、docker的安装部署

#### 1、docker软件版本

```
1、docker-io
2、docker-ce
3、docker-ee
```

#### 2、docker-ce软件安装

##### 1) 安装docker-ce

```
 # wget -O /etc/yum.repos.d/docker-ce.repo https://repo.huaweicloud.com/docker-ce/linux/centos/docker-ce.repo 
 # sed -i 's+download.docker.com+repo.huaweicloud.com/docker-ce+' /etc/yum.repos.d/docker-ce.repo 
```

```
[root@test ~]# yum install -y docker-ce 

[root@test ~]# systemctl enable docker
[root@test ~]# systemctl start docker

```

```
[root@test ~]# docker version 
Client: Docker Engine - Community
 Version:           20.10.5
 API version:       1.41
 Go version:        go1.13.15
 Git commit:        55c4c88
 Built:             Tue Mar  2 20:33:55 2021
 OS/Arch:           linux/amd64
 Context:           default
 Experimental:      true

Server: Docker Engine - Community
 Engine:
  Version:          20.10.5
  API version:      1.41 (minimum version 1.12)
  Go version:       go1.13.15
  Git commit:       363e9a8
  Built:            Tue Mar  2 20:32:17 2021
  OS/Arch:          linux/amd64
  Experimental:     false

```

##### 2) 将镜像仓库地址修改为国内地址

```
[root@test ~]# cat /etc/docker/daemon.json 
{
"registry-mirrors": ["https://ij8ids1a.mirror.aliyuncs.com"]
}
[root@test ~]# systemctl restart docker
[root@test ~]# 

```

#### 3、主机网络变化

##### 1) docker0网卡

```
[root@test ~]# ifconfig
docker0: flags=4099<UP,BROADCAST,MULTICAST>  mtu 1500
        inet 172.17.0.1  netmask 255.255.0.0  broadcast 172.17.255.255
        ether 02:42:64:5d:c4:de  txqueuelen 0  (Ethernet)
        RX packets 0  bytes 0 (0.0 B)
        RX errors 0  dropped 0  overruns 0  frame 0
        TX packets 0  bytes 0 (0.0 B)
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0

```

##### 2) nat转换规则

```
[root@test ~]# cat /proc/sys/net/ipv4/ip_forward
1
[root@test ~]# iptables -t nat -nL
Chain PREROUTING (policy ACCEPT)
target     prot opt source               destination         
DOCKER     all  --  0.0.0.0/0            0.0.0.0/0            ADDRTYPE match dst-type LOCAL

Chain INPUT (policy ACCEPT)
target     prot opt source               destination         

Chain OUTPUT (policy ACCEPT)
target     prot opt source               destination         
DOCKER     all  --  0.0.0.0/0           !127.0.0.0/8          ADDRTYPE match dst-type LOCAL

Chain POSTROUTING (policy ACCEPT)
target     prot opt source               destination         
MASQUERADE  all  --  172.17.0.0/16        0.0.0.0/0       
```



### 三、容器基本操作

#### 1、查找镜像

```
[root@test ~]# docker search nginx
```

#### 2、下载镜像

```
[root@test ~]# docker image pull nginx
[root@test ~]# docker image pull centos
```

#### 3、查看镜像

```
[root@test ~]# docker image ls
REPOSITORY   TAG       IMAGE ID       CREATED        SIZE
nginx        latest    519e12e2a84a   43 hours ago   133MB
centos       latest    300e315adb2f   4 months ago   209MB
```

#### 4、创建容器 

```
[root@test ~]# docker run -ti --name c01 centos /bin/bash 

[root@test ~]# docker run -tid --name c02 centos ls

注意: 
	容器的运行是依赖于一个在容器中持续不断的进程的	
```

```
[root@test ~]# docker run -tid --name c05 nginx
a756f076a8fd140e96911d16741efc031f2e1ea149243787994e036e773595f1
```

#### 5、查看容器

```
[root@test ~]# docker ps -a
CONTAINER ID   IMAGE     COMMAND                  CREATED          STATUS                     PORTS     NAMES
a756f076a8fd   nginx     "/docker-entrypoint.…"   4 minutes ago    Up 4 minutes               80/tcp    c05
4716d05849dc   nginx     "/docker-entrypoint.…"   5 minutes ago    Exited (0) 4 minutes ago             c04

```

#### 6、查看容器的详细信息

```
[root@test ~]# docker inspect a756
```

#### 7、连接容器

```
[root@test ~]# docker exec -ti c01 /bin/bash
```

#### 8、停止/启动容器

```
[root@test ~]# docker stop c01
[root@test ~]# docker start c01
```

#### 9、删除容器

```
[root@test ~]# docker rm c01 

[root@test ~]# docker rm -f c01

```



