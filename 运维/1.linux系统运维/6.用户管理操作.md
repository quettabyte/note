## 一、用户管理

### 一、用户介绍		

​	多用户多任务的操作系统 

​	

#### 	用户类型: 

​			管理员 root 

​			普通用户

​					系统用户

​							保证某应用程序可正常使用、运行 

​							不允许其登录系统，为安全性考虑 



#### 	用户相关文件

##### 	1、/etc/passwd

​				保存用户信息

```
root:x:0:0:root:/root:/bin/bash

格式: 
用户名:密码占位符:uid:gid:说明信息:宿主目录:shell

uid 用户ID 

	管理员  0
	1----999     系统用户
	1000+		 普通用户
	
shell：
	用于向内核翻译命令
	
	/bin/bash
		默认, 可正常登录系统、执行命令
	/sbin/nologin
		不允许登录系统，适用于系统用户
```



##### 2、/etc/shadow文件 

##### 		保存用户的密码 				





### 二、用户管理操作

#### 1、创建用户

```
# useradd  [选项]  用户名

[root@localhost ~]# useradd userA
```

常用选项：

```
1) -u  用户ID

[root@localhost ~]# useradd -u 2000 userC
```



```
2) -s  shell      指定用户的shell

   -M			  不创建用户的宿主目录

[root@localhost ~]# useradd -s /sbin/nologin -M mysql

[root@localhost ~]# useradd -u 90 -s /sbin/nologin -M openstack
```



```
3)  -g 基本组 

[root@localhost ~]# groupadd hdfs
[root@localhost ~]# useradd -g hdfs hadoop
```



```
4) -G 附加组,附加组,附加组

[root@localhost ~]# groupadd nginx
[root@localhost ~]# groupadd httpd
[root@localhost ~]# groupadd tomcat
[root@localhost ~]# 
[root@localhost ~]# useradd -G nginx,httpd,tomcat  www
```



#### 2、切换用户

```
# su - 用户名 

[root@localhost ~]# su - www
```



#### 3、设置用户密码

```
# passwd [选项] [用户名]

//修改当前用户密码 
[root@localhost ~]# passwd 
Changing password for user root.
New password: 
Retype new password: 
passwd: all authentication tokens updated successfully.

//修改指定用户的密码， 只有管理员root可成功执行 
[root@localhost ~]# passwd www
```



```
1) -l   锁定用户密码 
[root@localhost ~]# passwd -l www
Locking password for user www.
passwd: Success
```



```
2) -u   解锁用户密码 
[root@localhost ~]# passwd -u www
Unlocking password for user www.
passwd: Success
```



```
3)  -e  强制用户密码过期

[root@localhost ~]# passwd -e www
Expiring password for user www.
passwd: Success
```



#### 4、查看用户ID信息

```
[root@localhost ~]# id www
uid=2003(www) gid=2007(www) groups=2007(www),2004(nginx),2005(httpd),2006(tomcat)
```



#### 5、修改用户信息 

```
# usermod [选项] 用户名 

-u   修改用户ID 

[root@localhost ~]# id userA
uid=1003(userA) gid=1003(userA) groups=1003(userA)
[root@localhost ~]# 
[root@localhost ~]# usermod -u 3000 userA

[root@localhost ~]# id userA
uid=3000(userA) gid=1003(userA) groups=1003(userA)
[root@localhost ~]# 


-s    修改用户shell 

[root@localhost ~]# grep "userB" /etc/passwd
userB:x:1004:1004::/home/userB:/bin/bash

[root@localhost ~]# usermod -s /sbin/nologin userB
 
[root@localhost ~]# grep "userB" /etc/passwd
userB:x:1004:1004::/home/userB:/sbin/nologin


-G 附加组, 附加组     将用户加入用户组 

[root@localhost ~]# id userC
uid=2000(userC) gid=2000(userC) groups=2000(userC)

[root@localhost ~]# groupadd caiwu
[root@localhost ~]# usermod -G caiwu userC

[root@localhost ~]# id userC
uid=2000(userC) gid=2000(userC) groups=2000(userC),2008(caiwu)

[root@localhost ~]# usermod -aG caiwu userC
[root@localhost ~]# id userC
uid=2000(userC) gid=2000(userC) groups=2000(userC),2008(caiwu),2009(jishu)

-L  锁定用户密码 
-U  解锁用户密码
```



#### 6、删除用户

```
# userdel [选项]  用户名 

-r   同时删除用户相关文件 

[root@localhost ~]# userdel -r userA
```



#### 7、查看用户登录信息

```
[root@localhost ~]# who 
root     pts/0        2020-12-17 17:09 (192.168.183.1)
root     pts/1        2020-12-17 18:00 (192.168.183.1)
www      :2           2020-12-17 19:35 (:2)
```



#### 8、查看失败的登录 

```
[root@localhost ~]# lastb 
```



#### 9、查看所有登录行为 

```
[root@localhost ~]# last
```





### 三、用户组管理操作

用户组相关文件: 

​		/etc/group 



#### 1、创建用户组

```
# groupadd  用户组名 
```



#### 2、删除用户组

```
# groupdel  用户组名
```



#### 3、从组中删除用户

```
[root@localhost ~]# grep "tomcat" /etc/group
tomcat:x:2006:www,user01,user02

[root@localhost ~]# gpasswd -d user01 tomcat
Removing user user01 from group tomcat

[root@localhost ~]# grep "tomcat" /etc/group
tomcat:x:2006:www,user02
```





### 四、用户相关配置文件 



每创建一个用户，系统会自动将/etc/skel目录的文件复制到用户家目录

```
[root@localhost ~]# ls -a /home/user06/
.  ..  .bash_logout  .bash_profile  .bashrc
```



#### 1)  .bash_profile    【定义环境变量】

​		该文件中的命令，会在用户登录系统时自动执行 

```
[root@localhost ~]# vim /home/user01/.bash_profile 
	echo '谨慎操作！！！！！！'

[root@localhost ~]# su - user01
Last login: Thu Dec 17 23:02:59 CST 2020 on pts/6
谨慎操作！！！！！！
[user01@localhost ~]$ exit
```



#### 全局文件  /etc/profile

​		针对系统中所有用户生效



#### 2) .bashrc   【定义命令别名】

​		该文件的命令，会在用户打开新终端时自动执行 

#### 全局文件   /etc/bashrc



```
//查看别名

[root@localhost ~]# alias 



删除别名 

[root@localhost ~]# unalias cs 

示例：为用户user01定义命令别名 

[root@localhost ~]# vim /home/user01/.bashrc 
alias lc='ls -ldh /etc/'

[root@localhost ~]# su - user01
Last login: Thu Dec 17 23:07:23 CST 2020 on pts/5
谨慎操作!!!!!
[user01@localhost ~]$ 
[user01@localhost ~]$ 
[user01@localhost ~]$ lc
drwxr-xr-x. 142 root root 8.0K Dec 17 23:15 /etc/
```



#### 3) .bash_history

​		用户登录过系统后，才会出现

​		用于记录对应用户的历史命令 

```
# history   //查看历史命令

# history -c //清空历史命令
```





### 四、重置root密码 

1、重启系统 

2、启动到grub菜单界面，按上下键，暂停启动

3、选择gruab菜单中第一项，按字母e编辑系统启动配置文件 

4、找到linux16开头的行，在行尾添加rd.break 

5、按ctrl + x再次启动，进入救援模式 

6、以读写的方式重新挂载根目录 

```
switch_root# mount -o rw,remount  /sysroot
```

7、切换到救援模式根目录

```
switch_root# chroot /sysroot
```

8、使用passwd命令重置密码

```
sh-4.2# passwd root  
```

9、创建隐藏文件

```
sh-4.2# touch /.autorelabel
```

10、敲两次exit退出救援模式，系统会正常启动 

































