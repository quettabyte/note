## DHCP服务

### 一、dhcp介绍

​	dhcp   应用层协议   

​	动态主机配置协议 

​	作用: 为主机动态分配tcp/ip参数(ip地址、掩码、网关、DNS服务器地址)



#### Linux实现dhcp服务

```
软件: dhcp
配置文件: /etc/dhcp/dhcpd.conf
服务: dhcpd
端口: udp/67
```



### 二、DHCP服务的配置 



#### 1、关闭防火墙、SELinux 



#### 2、为服务器配置固定地址 

```
[root@dhcp_server ~]# cat /etc/sysconfig/network-scripts/ifcfg-ens33 
TYPE="Ethernet"
BOOTPROTO=none
IPADDR=192.168.183.10
PREFIX=24
GATEWAY=192.168.183.2
DNS1=114.114.114.114
DNS2=202.106.0.20
NAME="ens33"
DEVICE="ens33"
ONBOOT="yes"
```



#### 3、安装dhcpd软件

```
[root@dhcp_server ~]# yum install -y dhcp
```



#### 4、复制dhcp的配置文件模板  

```
[root@dhcp_server ~]# cp /usr/share/doc/dhcp-4.2.5/dhcpd.conf.example  /etc/dhcp/dhcpd.conf 
cp: overwrite ‘/etc/dhcp/dhcpd.conf’? yes
```



#### 5、编辑dhcpd.conf配置文件 

```
[root@dhcp_server ~]# vim /etc/dhcp/dhcpd.conf 

subnet 192.168.183.0 netmask 255.255.255.0 {
  range 192.168.183.100 192.168.183.200;
  option routers 192.168.183.2;
  option domain-name-servers 114.114.114.114, 202.106.0.20;
}
```



#### 6、启动dhcp服务

```
[root@dhcp_server ~]# systemctl start dhcpd
[root@dhcp_server ~]# systemctl enable dhcpd
Created symlink from /etc/systemd/system/multi-user.target.wants/dhcpd.service to /usr/lib/systemd/system/dhcpd.service.
[root@dhcp_server ~]# 
[root@dhcp_server ~]# ps -elf | grep dhcp
4 S dhcpd     11351      1  0  80   0 - 25308 poll_s 15:54 ?        00:00:00 /usr/sbin/dhcpd -f -cf /etc/dhcp/dhcpd.conf -user dhcpd -group dhcpd --no-pid
0 R root      11372  11071  0  80   0 - 28165 -      15:55 pts/0    00:00:00 grep --color=auto dhcp
[root@dhcp_server ~]# 
[root@dhcp_server ~]# netstat -anup | grep dhcp
udp        0      0 0.0.0.0:67              0.0.0.0:*                           11351/dhcpd   
```



#### 7、测试dhcp服务正常工作

```
关闭虚拟网络中自带的DHCP服务，避免影响测试 
虚拟网络编辑器 

打开一个客户端，将网卡修改为dhcp自动获取IP，查看可正常获取地址，并可正常访问外部网络 
```





### 三、dhcp工作原理 

```
1、客户端发送DHCP Discovery，探索dhcp服务器 
2、dhcp服务器发送DHCP Offer, 包括要分配的IP地址信息 
3、客户端发送DHCP Request请求配置IP
4、DHCP回复确认数据dhcp ACK
5、客户端发送Gratuation ARP的数据，检测IP地址是否冲突
```



























