## FTP服务

### 一、FTP介绍 

​		ftp	应用层协议 

​		文件传输协议

​		作用: 实现文件共享 



#### Linux实现FTP服务

```
软件: vsftpd
配置文件: /etc/vsftpd/vsftpd.conf 
服务: vsftpd 
端口: tcp/21


FTP服务的访问类型: 
	1、匿名访问，不需要用户名密码认证；  自动使用ftp用户
	2、本地用户认证


数据目录: 
	存放共享数据的目录, 可自定义 
	默认数据目录: 对应用户的宿主目录
	针对匿名用户： /var/ftp 
	
	[root@node03 ~]# grep "ftp" /etc/passwd
	ftp:x:14:50:FTP User:/var/ftp:/sbin/nologin
```





### 二、匿名用户相关配置

```
[root@ftp_server ~]# yum install -y vsftpd 

[root@ftp_server ~]# systemctl start vsftpd
[root@ftp_server ~]# systemctl enable vsftpd

[root@ftp_server ~]# netstat -antp | grep ftp
tcp6       0      0 :::21                   :::*                    LISTEN      1432/vsftpd      

客户端访问:  
ftp://192.168.183.10
```



##### 1、是否允许匿名访问

```
anonymous_enable=YES
```



##### 2、允许匿名用户上传文件 

```
anon_upload_enable=YES

注意: 
	1、匿名用户不允许直接在数据目录下上传文件，需要在数据目录下创建子目录 
	2、确保匿名用户对子目录本地拥有读写权限 
```



##### 3、允许匿名用户上传目录 

```
anon_mkdir_write_enable=YES
```



##### 4、允许匿名用户可执行其他写操作(重命名、删除)

```
anon_other_write_enable=YES
```



##### 5、允许匿名用户可正常下载上传的文件 

```
anon_umask=022
```



##### 6、修改匿名用户的数据目录 

```
anon_root=目录名称 
```





### 三、本地用户认证的访问

##### 1、是否启用本地用户认证的访问

```
local_enable=YES
```

##### 2、修改本地用户的数据目录 

```
local_root=目录名称
```



### 四、FTP客户端的使用

```
windows: 
	FileZilla
```



```
Linux: 
	lftp工具 
	
[root@node02 ~]# lftp 192.168.183.10

lftp 192.168.183.10:/> get 9.jpg 				//下载单个文件
lftp 192.168.183.10:/> mget 2.jpg 3.jpg 4.jpg 	//下载多个文件
Total 3 files transferred

lftp 192.168.183.10:/> mirror upload/			//下载目录 
Total: 1 directory, 2 files, 0 symlinks
New: 2 files, 0 symlinks
lftp 192.168.183.10:/> exit

[root@node02 ~]# lftp 192.168.183.10 -u king
```





### 五、FTP工作原理  

```
客户端与服务器的21/tcp端口建立命令连接, 用于传输认证的用户名、密码、相关操作指令
客户端与服务器建立数据连接，通过数据连接传输实体数据 
```



```
FTP的工作模式: 
	主动模式
		客户端与服务器的21端口建立命令连接，服务器产生固定的20端口用于和客户端建立数据连接
	被动模式 
		客户端与服务器的21端口建立命令连接，
		服务器随机产生>1024的随机数据端口，并通过之前建立好的命令连接将端口告知客户端 
		客户端再与服务器建立数据连接，传输数据
```























