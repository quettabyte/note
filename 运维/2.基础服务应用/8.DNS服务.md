## DNS服务

### 一、DNS介绍

​	DNS	应用层协议

​	Domain Name System  域名系统 

​	作用: 域名解析, 解析主机名所对应的IP地址 

​			正向解析

​					根据主机名解析对应的IP地址

​			反向解析

​					根据IP地址解析对应的主机名 



### 二、DNS核心概念 

#### 1、区域  zone 

```
正向区域
	本质上就是个二级域名	
	linux.com
	
反向区域
	x.x.x.in-addr.arpa 
		1.168.192.in-addr.arpa
		10.16.172.in-addr.arpa 
```



#### 2、记录  record

```
常见记录类型: 

1、A记录
	主机记录
	记录主机名、IP地址的对应关系 
	
	www.baidu.com	A	1.1.1.1 
	

2、PTR记录
	反向指针记录
	记录IP地址、主机名的对应关系  
	
	1.1.1.1		PTR		www.baidu.com.
	
	
3、NS记录
	用于标识DNS服务器本身 
	
			NS	test1.linux.com.
	test1.linux.com	A	2.2.2.2 
	
4、MX记录
	用于标识邮件服务器 
	
			MX   5	mail01.linux.com.
	mail01.linux.com.	A	4.4.4.4 
			MX	10	mail02.linux.com.
	mail02.linux.com.	A	5.5.5.5
	
	
5、CNAME记录 
	别名记录
	
	www.baidu.com		CNAME		www.a.shifen.com.
			
	
```



#### 3、DNS查询类型

```
递归查询
	客户端仅发送一次查询请求 
迭代查询
	发送多次请求 
```



#### 4、DNS在Linux的实现

```
软件: bind, bind-chroot 
配置文件: 
	主配置文件: /var/named/chroot/etc/named.conf        		//定义区域
	记录文件: /var/named/chroot/var/named/*					//定义记录信息 
服务: named, named-chroot 
端口: 53/udp 
```





### 三、DNS服务的配置

​	web.linux.com		192.168.1.1

​	ftp.linux.com		  192.168.1.2

​	mail.linux.com		192.168.1.3

​	ns01.linux.com		192.168.183.10



#### 1、关闭防火墙、SElinux、时间同步 



#### 2、安装dns相关软件

```
[root@localhost ~]# yum install -y bind bind-chroot 
```



#### 3、编辑named.conf主配置文件，创建区域  

```
[root@localhost ~]# vim /var/named/chroot/etc/named.conf 
options {
   directory "/var/named";				//指定记录文件的存储位置
};

zone "linux.com" {
   type master;							//指定区域类型为master
   file "linux.com.zone";				//指定区域对应的记录文件名称 
};
```



#### 4、复制记录文件 

```
[root@localhost ~]# cp /usr/share/doc/bind-9.11.4/sample/var/named/named.localhost  /var/named/chroot/var/named/linux.com.zone
```



#### 5、添加记录信息

```
[root@localhost ~]# cat /var/named/chroot/var/named/linux.com.zone
$TTL 1D
@	IN SOA	linux.com. 454452000.qq.com. (
					0	; serial
					1D	; refresh
					1H	; retry
					1W	; expire
					3H )	; minimum
	NS	ns01.linux.com.
ns01	A	192.168.183.10	
web	A	192.168.1.1
ftp	A	192.168.1.2
	MX  5   mail.linux.com.
mail	A	192.168.1.3
```



#### 6、启动named服务 

```
[root@localhost ~]# systemctl start named named-chroot
[root@localhost ~]# systemctl enable named named-chroot

[root@localhost ~]# ps -elf | grep name
5 S named      1482      1  0  80   0 - 41810 sigsus 11:48 ?        00:00:00 /usr/sbin/named -u named -c /etc/named.conf
5 S named      1532      1  1  80   0 - 40988 sigsus 11:48 ?        00:00:00 /usr/sbin/named -u named -c /etc/named.conf -t /var/named/chroot
0 R root       1556   1078  0  80   0 - 28165 -      11:48 pts/0    00:00:00 grep --color=auto name

[root@localhost ~]# netstat -anup | grep name
Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name    
udp        0      0 192.168.183.10:53       0.0.0.0:*                           1532/named          
```



#### 7、测试DNS服务工作是否正常 

```
C:\>nslookup
默认服务器:  gjjline.bta.net.cn
Address:  202.106.0.20

> server 192.168.183.10
默认服务器:  localhost
Address:  192.168.183.10

> web.linux.com
服务器:  localhost
Address:  192.168.183.10

名称:    web.linux.com
Address:  192.168.1.1

> ftp.linux.com
服务器:  localhost
Address:  192.168.183.10

名称:    ftp.linux.com
Address:  192.168.1.2

> mail.linux.com
服务器:  localhost
Address:  192.168.183.10

名称:    mail.linux.com
Address:  192.168.1.3

> ns01.linux.com
服务器:  localhost
Address:  192.168.183.10

名称:    ns01.linux.com
Address:  192.168.183.10

> www.baidu.com
服务器:  localhost
Address:  192.168.183.10

DNS request timed out.
    timeout was 2 seconds.
DNS request timed out.
    timeout was 2 seconds.
非权威应答:
名称:    www.a.shifen.com
Addresses:  110.242.68.4
          110.242.68.3
Aliases:  www.baidu.com

> exit
```



### 四、配置DNS实现反向解析  

#### 1、编辑named.conf主配置文件，添加反向区域 

```
[root@localhost ~]# vim /var/named/chroot/etc/named.conf 

zone "1.168.192.in-addr.arpa" {
    type master;
    file "192.168.1.zone";
};
```



#### 2、添加反向区域对应的记录文件 

```
[root@localhost ~]# cp /var/named/chroot/var/named/linux.com.zone  /var/named/chroot/var/named/192.168.1.zone
[root@localhost ~]# ls /var/named/chroot/var/named/
192.168.1.zone  linux.com.zone
[root@localhost ~]# 
[root@localhost ~]# vim /var/named/chroot/var/named/192.168.1.zone 
$TTL 1D
@	IN SOA	linux.com. 454452000.qq.com. (
					0	; serial
					1D	; refresh
					1H	; retry
					1W	; expire
					3H )	; minimum
	NS	ns01.linux.com.
ns01	A	192.168.183.10	
1	PTR	web.linux.com.
2	PTR	ftp.linux.com.
3	PTR	mail.linux.com.
```



#### 3、重启DNS服务，测试 

```
[root@localhost ~]# systemctl restart named named-chroot

C:\>nslookup
默认服务器:  gjjline.bta.net.cn
Address:  202.106.0.20

> server 192.168.183.10
默认服务器:  localhost
Address:  192.168.183.10

> 192.168.1.1
服务器:  localhost
Address:  192.168.183.10

名称:    web.linux.com
Address:  192.168.1.1

> 192.168.1.2
服务器:  localhost
Address:  192.168.183.10

名称:    ftp.linux.com
Address:  192.168.1.2

> 192.168.1.3
服务器:  localhost
Address:  192.168.183.10

名称:    mail.linux.com
Address:  192.168.1.3

>


```





























