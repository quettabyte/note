## memcached数据库应用

### 一、memcached介绍

```
NoSQL数据库

作用: 缓存服务器
```

![image-20210304145046735](C:\Users\admin\AppData\Roaming\Typora\typora-user-images\image-20210304145046735.png)

#### 1、特性

```
1、开源的
2、分布式、高性能
3、以键值key-value对的方式存储数据  
4、仅支持在内存中存储数据  
```

#### 2、memcached使用的内存的方式

![image-20210304152335137](C:\Users\admin\AppData\Roaming\Typora\typora-user-images\image-20210304152335137.png)

```
默认大小48Bytes, 增长因子1.25
```





### 二、安装memcached

#### 1、安装libevent

```
[root@localhost ~]# tar xf libevent-2.1.8-stable.tar.gz 
[root@localhost ~]# cd libevent-2.1.8-stable/
[root@localhost libevent-2.1.8-stable]# ./configure --prefix=/usr/local/libevent 
[root@localhost libevent-2.1.8-stable]# make 
[root@localhost libevent-2.1.8-stable]# make install 

```



#### 2、安装memcached

```
[root@localhost ~]# tar xf memcached-1.6.9.tar.gz 
[root@localhost ~]# cd memcached-1.6.9/
[root@localhost memcached-1.6.9]# ./configure --prefix=/usr/local/memcached --with-libevent=/usr/local/libevent/
[root@localhost memcached-1.6.9]# make 
[root@localhost memcached-1.6.9]# make install 

```



#### 3、启动memcached

```
[root@localhost ~]# useradd -s /sbin/nologin -M memcached
[root@localhost ~]# /usr/local/memcached/bin/memcached -l 192.168.140.10 -p 11211 -u memcached -d -m 800M -c 2048 -n 10 -f 2 -t 8 

常用选项说明:
	1) -l   监听地址
	2) -p	监听端口
	3) -u	启动memcached的用户
	4) -d	后台运行
	5) -m	允许memcached使用的最大内存
	6) -c	最大并发连接数
	7) -n	memcached分配内存时的最小单位 
	8) -f	内存的增长因子 
	9) -t	线程数

[root@localhost ~]# netstat -antp | grep mem
tcp        0      0 192.168.140.10:11211    0.0.0.0:*               LISTEN      31151/memcached     

[root@localhost ~]# ps -elf | grep mem
1 S memcach+  31151      1  0  80   0 - 179579 ep_pol 15:42 ?       00:00:00 /usr/local/memcached/bin/memcached -l 192.168.140.10 -p 11211 -u memcached -d -m 800M -c 2048 -n 10 -f 2 -t 8

```



#### 4、测试连接memcached

```
telnet工具
	作用: 连接测试tcp服务, 判断tcp服务是否正常工作 

[root@localhost ~]# telnet 192.168.140.10 11211 
Trying 192.168.140.10...
Connected to 192.168.140.10.
Escape character is '^]'.
set name 0 20 6				//0 20  数据过期时间     6 数据长度
martin
STORED
get name
VALUE name 0 6
martin
END
quit
Connection closed by foreign host.

```



#### 5、通过PHP代码连接memcached

```
[root@localhost ~]# yum install -y httpd php gd php-gd php-devel php-pecl-memcache
[root@localhost ~]# php -m | grep -i mem
memcache

[root@localhost ~]# cat /var/www/html/test1.php
<?php
   $memcache_obj = memcache_connect('192.168.140.10', 11211);
   $memcache_obj->add("name", "Martin");
   echo $memcache_obj->get("name");
?>
```















