## redis数据库	

### 一、redis数据库介绍

```
NoSQL  Not Only SQL 	非关系型数据库 
```

#### 1、关系型数据库、非关系型数据库的区别 

```
性能高、速度快、支持高并发连接

1、非关系型数据库基于内存存储数据  
2、摒弃了关系型数据的约束限制
3、采用o1算法进行设计开发 
```

#### 2、作用

```
关系型数据库：MySQL, Oralce, SQL Server, PostgreSQL 

1、数据持久化存储 
```

```
非关系型数据库:
	1、缓存服务器 
	2、作为会话数据的共享存储，实现会话保持 
```

#### 3、特性

```
1、跨平台、开源
2、采用键值key-value对进行数据存储 
3、基于内存存储数据 
4、支持数据持久化存储
	两种方式:
		rdb数据文件、aof日志
5、支持主从复制、分片集群
6、支持多实例部署
7、支持多种数据类型
8、支持事务

https://redis.io/
```



### 二、redis安装部署

#### 1、redis安装

```
[root@localhost ~]# yum install -y gcc 

[root@localhost ~]# wget https://download.redis.io/releases/redis-6.2.1.tar.gz
[root@localhost ~]# tar xf redis-6.2.1.tar.gz 
[root@localhost ~]# cd redis-6.2.1/
[root@localhost redis-6.2.1]# make 
[root@localhost redis-6.2.1]# make PREFIX=/usr/local/redis install 

[root@localhost ~]# cp redis-6.2.1/redis.conf /usr/local/redis/conf/
[root@localhost ~]# ls /usr/local/redis/conf/
redis.conf

```

#### 2、redis启动管理

```
1、启动redis

[root@localhost ~]# redis-server /usr/local/redis/conf/redis.conf 			//默认前台启动
[root@localhost ~]# nohup redis-server /usr/local/redis/conf/redis.conf & 	//后台启动

[root@localhost ~]# netstat -antp | grep redis
tcp        0      0 127.0.0.1:6379          0.0.0.0:*               LISTEN      11426/redis-server  
tcp6       0      0 ::1:6379                :::*                    LISTEN      11426/redis-server  


2、关闭redis

[root@localhost ~]# redis-cli shutdown

```

#### 3、redis基本数据读写

```
[root@localhost ~]# redis-cli 
127.0.0.1:6379> 
127.0.0.1:6379> set name martin
OK
127.0.0.1:6379> get name
"martin"
127.0.0.1:6379> mset nginx v1.18 httpd v2.4
OK
127.0.0.1:6379> mget nginx httpd
1) "v1.18"
2) "v2.4"
127.0.0.1:6379> set url http://test.linux.com EX 10		//设置数据的超时时间 
OK
127.0.0.1:6379> get url
"http://test.linux.com"
127.0.0.1:6379> 
127.0.0.1:6379> get url
(nil)

127.0.0.1:6379> keys *			//查看所有数据  

127.0.0.1:6379> del name

127.0.0.1:6379> set test1 "martin robin lz"
OK
127.0.0.1:6379> get test1
"martin robin lz"


127.0.0.1:6379> set data 10
OK
127.0.0.1:6379> incr data
(integer) 11
127.0.0.1:6379> incr data
(integer) 12
127.0.0.1:6379> get data
"12"
127.0.0.1:6379> INCRBY data 5
(integer) 17
127.0.0.1:6379> get data
"17"
127.0.0.1:6379> decr data
(integer) 16
127.0.0.1:6379> DECR data
(integer) 15
127.0.0.1:6379> get data
"15"
127.0.0.1:6379> DECRBY data 5
(integer) 10
127.0.0.1:6379> get data
"10"


//验证事务的特性 

127.0.0.1:6379> get data
"10"
127.0.0.1:6379> multi				//启动事务
OK
127.0.0.1:6379(TX)> incr data
QUEUED
127.0.0.1:6379(TX)> incr data
QUEUED
127.0.0.1:6379(TX)> get data
QUEUED
127.0.0.1:6379(TX)> exec			//提交事务
1) (integer) 11
2) (integer) 12
3) "12"


//redis默认有16个数据库，名称0--15 

127.0.0.1:6379[3]> select 1
OK
127.0.0.1:6379[1]> set name martin
OK
127.0.0.1:6379[1]> get name
"martin"
127.0.0.1:6379[1]> 
127.0.0.1:6379[1]> select 2
OK
127.0.0.1:6379[2]> get name
(nil)

```



#### 4、通过PHP代码连接redis

```
[root@localhost ~]# yum install -y httpd php gd php-gd php-devel
[root@localhost ~]# systemctl start httpd
[root@localhost ~]# systemctl enable httpd

1) 为PHP安装连接redis模块

[root@localhost ~]# tar xf redis-3.1.3.tgz 
[root@localhost ~]# cd redis-3.1.3/
[root@localhost redis-3.1.3]# /usr/bin/phpize 
[root@localhost redis-3.1.3]# ./configure --enable-redis --with-php-config=/usr/bin/php-config 
[root@localhost redis-3.1.3]# make
[root@localhost redis-3.1.3]# make install
Installing shared extensions:     /usr/lib64/php/modules/

[root@localhost ~]# vim /etc/php.ini

extension=/usr/lib64/php/modules/redis.so

[root@localhost ~]# systemctl restart httpd
[root@localhost ~]# php -m | grep -i redis
redis

2) 测试代码 

[root@localhost ~]# cat /var/www/html/test1.php 
<?php
  $redis = new Redis();
  $redis -> connect("127.0.0.1",6379);
  $redis -> set("name", "Tome");
  $var = $redis -> get("name");
  echo $var;
?>

```



### 三、redis配置文件

#### 1、加载子配置文件

```
include /path/to/local.conf
```

#### 2、加载模块

```
loadmodule /path/to/my_module.so
```

#### 3、设置redis监听地址

```
bind 192.168.140.10

[root@localhost ~]# netstat -antp | grep redis
tcp        0      0 192.168.140.10:6379     0.0.0.0:*               LISTEN      9397/redis-server 1 

[root@localhost ~]# redis-cli -h 192.168.140.10
192.168.140.10:6379> 
192.168.140.10:6379> set a 10
OK
192.168.140.10:6379> exit

```

#### 4、设置redis监听端口

```
port 6379
```



#### 5、设置redis请求队列的长度

```
tcp-backlog 1000

同时修改系统参数/proc/sys/net/core/somaxconn
建议: 值设置到800-1000间，不要过大

修改系统的两种方式:

1、临时生效

[root@localhost ~]# echo 1000 > /proc/sys/net/core/somaxconn 

2、永久生效

1) 查看所有系统参数 

[root@localhost ~]# sysctl -a 

2) 系统参数配置文件 

[root@localhost ~]# cat /etc/sysctl.conf 
net.core.somaxconn = 1000

3) 重新读取参数配置文件

[root@localhost ~]# sysctl -p
net.core.somaxconn = 1000

```



#### 6、设置客户端空闲连接的超时时间

```
timeout 5
```



#### 7、设置redis默认在后台启动

```
daemonize yes
```



#### 8、设置pid文件存放路径 

```
pidfile /var/run/redis_6379.pid
```



#### 9、设置redis错误日志

```
loglevel warning
logfile "/var/log/redis.log"

```



#### 10、设置redis数据库数量

```
databases 16
```

















