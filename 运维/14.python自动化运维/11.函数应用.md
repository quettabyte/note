## 函数应用

### 一、函数、模块、包

#### 一、函数

##### 1、函数

```
作用:
	1、实现功能的重复使用 
	2、方便代码二次修改
```

##### 2、函数定义

```
def 函数名称():
	执行的功能
	执行的功能
	
函数名称规范:
	1、只能包含字母、下划线、数字
	2、只能以字母、下划线开头
	3、见名知义	
	4、不能与python关键字
	5、从第二个单词开始首字母大写   fileReplace   fileRename
```

##### 3、调用函数

```
函数名称()
```

```
import string
import random

all_of_data = string.digits + string.ascii_letters

def randomString():
    data = ""
    for i in range(10):
        data = data + random.choice(all_of_data)
    print(data)

randomString()
randomString()
```



#### 二、模块

```
本质上就是.py结尾的文件

模块中的方法本质上就是事先定义好的函数

__name__ == "__main__"		代表文件独立运行
```

##### 模块式写法:

```
def f1():
    .....
    
def f2():
     .....

def f3():
     ......
     
if __name__ == "__main__":
     f1()
     f2()
     f3()
```



#### 三、包  package

```
本质上就是目录 

项目目录
	功能目录
		__init__.py 
```

```
import 模块名称 

from 包名 import 模块名称 

from 包名.模块名称 import 方法名称 
```



### 二、函数参数

```
作用: 增强功能的灵活性 

形参、实参

def 函数名称(参数1,参数2,参数3):
	............

调用函数时:

函数名称(数据1,数据2,数据3)
```

```
import string
import random

all_of_data = string.digits + string.ascii_letters

def randomString(number):       # number 循环次数
    data = ""
    for i in range(number):
        data = data + random.choice(all_of_data)
    print(data)

if __name__ == '__main__':
    randomString(10)
    randomString(30)
```



#### 示例: 文件管理模块

```
import os
import hashlib

# 获取指定目录下所有文件绝对路径
def getFile(directory):
    for dir_name, sub_dir_list, file_name_list in os.walk(directory):
        if len(file_name_list) > 0:
            for f_name in file_name_list:
                full_file_name = dir_name + "\\" + f_name
                print(full_file_name)

# 文件MD5校验  fileMD5
def fileMD5(file_name):
    md5_tools = hashlib.md5()
    with open(file_name, mode="rb") as fobj:
        while True:
            data = fobj.read(4096)
            if data:
                md5_tools.update(data)
            else:
                break
    print(md5_tools.hexdigest())
```



### 三、函数参数类型

```
1、位置参数
2、关键字参数
3、默认参数
4、可变长参数
```

#### 1、位置参数

```
特性: 
	调用函数时，必须得给位置参数传递实体数据 
```

```
def f1(number):
    print("?" * number)

if __name__ == '__main__':
    f1(10)
```

#### 2、默认参数

```
在为函数定义参数时，可以为参数指定默认值 

注意:
	函数有多个参数时，默认参数必须在最后，避免出现歧义
```

```
def f1(number=5):
    print("?" * number)

if __name__ == '__main__':
    f1()
    f1(20)
```

```
def dbCONN(ip, user, pwd, port=3306):
    print("mysql -u %s -p%s -h %s -P %s" % (user, pwd, ip, port))

if __name__ == '__main__':
    dbCONN("10.1.1.1", "admin", "redhat")
    dbCONN("10.1.1.1", "admin", "redhat", "3318")
```

#### 3、关键字参数

```
调用函数时，可以通过指定形参名的方式传递参数 
```

```
def sshCONN(ip, username):
    print("ssh %s@%s" % (username, ip))

if __name__ == '__main__':
    sshCONN(username="martin", ip="10.1.1.2")
```

#### 4、可变长参数

```
调用函数时，可以传递任意个参数 

实现方式：
	1、通过元组实现
	2、通过字典实现
```

##### 方式一: 通过元组的方式实现

```
def test1(*args):
    print(type(args))
    print(args)

if __name__ == '__main__':
    test1()
    test1("nginx")
    test1("nginx", "httpd", "iis", "openrestry")
```

```
def test1(*args):
    if len(args) > 0:
        for ip in args:
            print("ssh root@%s yum install -y httpd" % (ip))

if __name__ == '__main__':
    test1("10.1.1.1")
    test1("10.1.1.1", "10.1.1.2", "10.1.1.3")
```

##### 方式二: 通过字典的方式实现

```
def test2(**kwargs):
    print(type(kwargs))
    print(kwargs)

if __name__ == '__main__':
    test2()
    test2(a=10)
    test2(a=10, b=20, c=30)
```

```
def test3(*args, **kwargs):
    print(args)
    print(kwargs)

if __name__ == '__main__':
    test3("nginx", "httpd", "iis")
    test3(a=10, b=20, c=30)
    test3("10.1.1.1", "10.1.1.2", "10.1.1.3", aa=100, bb=200, cc=300)
```



### 四、返回值 

```
return 数据

注意事项:
	1、可以返回任意类型的数据 
	2、return代表函数结束， 不要在return语句后写任何代码 
```

```
def test01(n, m):
    data = n + m
    return data

if __name__ == '__main__':
    print(test01(10, 20))           # 输出函数返回值

    # 接收函数值
    result = test01(100, 200)
    # print(result)
    if result > 500:
        print("OK")
    else:
        print("Bad")
```

```
import hashlib

# 获取指定目录下所有文件绝对路径
def getFile(directory):
    file_list = []
    for dir_name, sub_dir_list, file_name_list in os.walk(directory):
        if len(file_name_list) > 0:
            for f_name in file_name_list:
                full_file_name = dir_name + "\\" + f_name
                file_list.append(full_file_name)
    return file_list

# 文件MD5校验  fileMD5
def fileMD5(file_name):
    md5_tools = hashlib.md5()
    with open(file_name, mode="rb") as fobj:
        while True:
            data = fobj.read(4096)
            if data:
                md5_tools.update(data)
            else:
                break
    return md5_tools.hexdigest()
```



#### 示例1: 校验文件差异

```
# 校验文件备份
import os
from funDemo import fileManager as fm

source_directory = r"D:\20201207\project1207\files"

def fileDiff():
    source_file_list = fm.getFile(source_directory)
    for source_file in source_file_list:
        dest_file = source_file.replace("files", "dest")
        # 判断同名的目的文件不存在
        if not os.path.exists(dest_file):
            print("文件%s缺失!!!!" % source_file)
        else:
            source_file_md5 = fm.fileMD5(source_file)
            dest_file_md5 = fm.fileMD5(dest_file)
            if source_file_md5 != dest_file_md5:
                print("源文件%s对应目的文件%s数据不一致!!!" % (source_file, dest_file))



if __name__ == '__main__':
    fileDiff()
```



#### 示例2: 实现文件完全备份、增量备份

```
import pickle
from funDemo import fileManager as fm
import datetime

# 完全备份
def fullBackup():
    source_directory = r"D:\20201207\project1207\files"
    current_time = datetime.datetime.now().strftime("%Y_%m_%d_%H_%M_%S")
    full_tar_file_name = r"D:\20201207\project1207\backup\data_full_%s.tar.gz" % current_time

    # {"文件名称":"MD5"}, 便于后续的增量备份
    file_md5 = {}

    # 创建备份包,添加文件
    full_tar_obj = tarfile.open(full_tar_file_name, mode="w:gz")
    source_file_list = fm.getFile(source_directory)
    for source_file in source_file_list:
        full_tar_obj.add(source_file)
        # 对文件进行MD5校验，将结果存入字典
        source_file_md5 = fm.fileMD5(source_file)
        file_md5[source_file] = source_file_md5
    full_tar_obj.close()

    # 将字典进行持久化存储
    md5_file = r"D:\20201207\project1207\backup\info.m5"
    with open(md5_file, mode="wb") as fobj:
        pickle.dump(file_md5, fobj)

# 增量备份
def increBackup():
    source_directory = r"D:\20201207\project1207\files"
    current_time = datetime.datetime.now().strftime("%Y_%m_%d_%H_%M_%S")

    # 创建增量压缩包
    incre_tar_file_name = r"D:\20201207\project1207\backup\data_incre_%s.tar.gz" % current_time
    incre_tar_obj = tarfile.open(incre_tar_file_name, mode="w:gz")

    # 获取完全备份时生成的字典
    md5_file = r"D:\20201207\project1207\backup\info.m5"
    with open(md5_file, mode="rb") as fobj:
        file_md5 = pickle.load(fobj)

    # 再次遍历files目录中的所有文件
    source_file_list = fm.getFile(source_directory)
    for source_file in source_file_list:
        # 判断新文件
        if source_file not in file_md5.keys():
            incre_tar_obj.add(source_file)
            # 将新文件的校验码加入字典，便于下一次的增量备份
            new_file_md5 = fm.fileMD5(source_file)
            file_md5[source_file] = new_file_md5
        else:
            # 检测文件内容的变化
            old_md5 = file_md5.get(source_file)
            new_md5 = fm.fileMD5(source_file)
            if old_md5 != new_md5:
                incre_tar_obj.add(source_file)
                # 修改现有文件的校验码，便于下一次的增量备份
                file_md5[source_file] = new_md5

    incre_tar_obj.close()

    # 更新硬盘中的字典
    with open(md5_file, mode="wb") as fobj:
        pickle.dump(file_md5, fobj)

if __name__ == '__main__':
    day = datetime.datetime.now().isoweekday()
    if day == 1:
        fullBackup()
    else:
        increBackup()3 
```



### 五、函数类型 

```
1、内置函数
	id(), type(), input(), set(), int(), str(), open()
2、自定义函数
	def 
	匿名函数	lambda关键字
		适用于功能简单的，节省代码 
```

#### 1、匿名函数

```
语法:

lambda 参数1，参数2，参数3:返回值 
```

```
test1 = lambda n, m:n + m

if __name__ == '__main__':
    print(test1(10, 20))
```

#### 2、sorted()	内置函数	排序

```
作用:
	以列表的形式返回排序后的数据，默认为升序
```

```
data_01 = [ 10, 432, 24, 235, 4336, 453 ]
new_data_01 = sorted(data_01)
print(new_data_01)


data_02 = ( 234, 432,45, 54, 5, 768, 68 )
new_data_02 = sorted(data_02, reverse=True)
print(new_data_02)
```

```
data_03 = { "192.168.1.1":1000, "10.1.1.1":2324, "172.16.1.1": 10 }

# key=     匿名函数， 根据匿名函数的返回值，作为排序的依据
new_data_03 = sorted(data_03.items(), key=lambda x:x[-1], reverse=True)

print(new_data_03)
```



### 六、全局变量、局部变量

#### 1、全局变量

```
被定义在函数外部的变量，称为全局变量
```

```
number = 10

def test1():
    print("数字: %s" % number)

def test2():
    print("再次调用: %s" % number)

if __name__ == '__main__':
    test1()
    test2()
```

##### 注意: 在函数内部要修改全局变量自身的值，事先需要使用globa进行声明 

```
number = 10

def test1():
    global number
    number = number + 1             # data = number + 1
    print("数字: %s" % number)

def test2():
    print("再次调用: %s" % number)

if __name__ == '__main__':
    test1()
    test2()
```



#### 2、局部变量

```
被定义在函数内部的变量，互不影响
```

```
def test1():
    data = "martin"
    data = "Tome"
    print(data)

def test2():
    data = "robin"
    print(data)

if __name__ == '__main__':
    test1()
    test2()
```



















