## 常用模板语言使用

### 一、案例: 用户登录成功显示服务器列表

#### 1、csrfmiddle  中间件

```
作用: 防止csrf攻击
原理:
	表单以post方式提交数据，该中间件需要验证数据中包含的令牌
```

```
<form action="" method="post">
	{% csrf_token %}
</form>
```



#### 2、request.POST字典 

```
接收表单以POST的方式提交的数据
```



#### 3、request.method属性

```
作用：获取HTTP请求的请求方法    GET/POST
```



#### 4、render()传参

```
render(request, template_name, {"data": 123})

作用: 向前端的界面传递数据，增加灵活性
```

```
前端界面基本调用数据:

	{{ data }}

```



##### urls.py

```
    path('login/', views.login),
    path('server/', views.server),
    path('process/', views.process),
```

##### views.py

```
from django.shortcuts import render, redirect
from django.http import HttpResponse

# 展示用户登录界面
def login(request):
    return render(request, "login.html")


# 展示服务器信息
def server(request):
    return render(request, "server.html")


# 接收用户数据、处理用户数据
def process(request):
    # print(request.POST)
    username = request.POST.get("user")
    password = request.POST.get("pwd")
    # print(username, password)
    if username == "martin" and password == "redhat":
        return redirect("/server/")
    elif username == "robin" and password == "123":
        return redirect("/server/")
    else:
        return redirect("/login/")
```

##### templates/login.html

```
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>用户登录</title>
</head>
<body>

    <h3>用户登录</h3>

    <div>
        <form action="/process/" method="post">
            {% csrf_token %}
            <span>用户名: </span>
            <input type="text" name="user" />

            <span>密码: </span>
            <input type="password" name="pwd" />

            <input type="submit" value="登录"/>
        </form>
    </div>

</body>
</html>
```

##### templates/server.html

```
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>服务器信息</title>
</head>
<body>

    <h3>服务器列表</h3>

    <div>
        <table border="1px">
            <tr>
                <td>编号</td>
                <td>服务器地址</td>
                <td>服务器型号</td>
                <td>服务器系统</td>
            </tr>
            <tr>
                <td>1</td>
                <td>192.168.140.10</td>
                <td>Vmware</td>
                <td>CentOS76</td>
            </tr>
            <tr>
                <td>2</td>
                <td>192.168.140.11</td>
                <td>Vmware</td>
                <td>CentOS76</td>
            </tr>
            <tr>
                <td>3</td>
                <td>192.168.140.12</td>
                <td>Vmware</td>
                <td>CentOS76</td>
            </tr>
        </table>
    </div>

</body>
</html>
```

##### 改动1： 合并用户登录展示、处理数据

##### template/login.html

```
        <form action="/login/" method="post">
            {% csrf_token %}
            <span>用户名: </span>
            <input type="text" name="user" />
```

##### views.py

```
# 展示用户登录界面, 接收用户数据、处理用户数据
def login(request):
    if request.method == "GET":
        return render(request, "login.html")
    elif request.method == "POST":
        # print(request.POST)
        username = request.POST.get("user")
        password = request.POST.get("pwd")
        # print(username, password)
        if username == "martin" and password == "redhat":
            return redirect("/server/")
        elif username == "robin" and password == "123":
            return redirect("/server/")
        else:
            return redirect("/login/")
```



##### 改动2: 在服务器列表界面显示当前用户名

##### views.py

```
def login(request):
    if request.method == "GET":
        return render(request, "login.html")
    elif request.method == "POST":
        # print(request.POST)
        username = request.POST.get("user")
        password = request.POST.get("pwd")
        # print(username, password)
        if username == "martin" and password == "redhat":
            # 向server地址传递用户名
            return redirect("/server/?user=%s" % username)
        elif username == "robin" and password == "123":
            return redirect("/server/?user=%s" % username)
        else:
            return redirect("/login/")


# 展示服务器信息
def server(request):
    # print(request.GET)
    # 接收login传递的用户名
    user = request.GET.get("user")
    return render(request, "server.html", {"name": user})
```

##### templates/server.html

```
<body>

    <h3>服务器列表</h3>

    <h4>当前用户: {{ name }}</h4>
```



### 二、render()传递数据

```
render(request, template_name, {})
```

##### views.py

```
def test(request):
    data_01 = [ "10.1.1.%s" % i for i in range(1, 21) ]
    data_02 = ( "nginx", "httpd", "tomcat", "IIS", "openrestry")
    data_03 = { "10.1.1.1":22, "10.1.1.3":3333, "10.1.1.4":4444 }
    return render(request, "test.html", {"AAA":"1.1.1.2",
                                         "data_01": data_01,
                                         "data_02": data_02,
                                         "data_03": data_03})

```

##### templates/test.html

```
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>

    <h1>{{ AAA }}</h1>

    <h2>列表: {{ data_01 }}</h2>
    <h2>单个地址: {{ data_01.1 }}</h2>
    <ul>
        {% for i in data_01 %}
            <li>{{ i }}</li>
        {% endfor %}
    </ul>

    <hr />

    <h2>元组: {{ data_02 }}</h2>
    <h2>单个数据: {{ data_02.2 }}</h2>
    <table border="1px">
        <tr>
            <td>编号</td>
            <td>软件名称</td>
        </tr>
        {% for s in data_02 %}
            <tr>
                <td>{{ forloop.counter }}</td>
                <td>{{ s }}</td>
            </tr>
        {% endfor %}
    </table>

    <hr />

    <h3>字典: {{ data_03 }}</h3>
    <h3>所有键: {{ data_03.keys }}</h3>
    <h3>所有值: {{ data_03.values }}</h3>
    <table border="1px">
        <tr>
            <td>服务器地址</td>
            <td>SSH端口</td>
        </tr>
        {% for k,v in data_03.items %}
            <tr>
                <td>{{ k }}</td>
                <td>{{ v }}</td>
            </tr>
        {% endfor %}
    </table>
</body>
</html>
```

































