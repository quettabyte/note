## Model 模型 —— 单表操作

### 一、Model模型介绍

#### 1、ORM介绍

```
数据库操作

类型:
	单表操作
	多表操作
```

```
基于ORM的方式操作数据库；以类的语法进行操作

核心思想:
	1、一个类代表一张表，一个类描述就是一个表结构 
	2、类的实例化对象代表一条具体的数据
```

```
必须存在APP
```

#### 2、Django支持的数据库类型

```
SQLite(默认)、MySQL、Oracle、PostgreSQL
```

##### 1） sqlite

```
DATABASES = {
    'default': {
        'ENGINE': 'django.db.backends.sqlite3',
        'NAME': BASE_DIR / 'db.sqlite3',
    }
}
```

##### 2） MySQL

```
DATABASES = {
    'default': {
        'ENGINE': 'django.db.backends.mysql',
        'NAME': 'mydatabase',
        'USER': 'mydatabaseuser',
        'PASSWORD': 'mypassword',
        'HOST': '127.0.0.1',
        'PORT': '5432',
    }
}
```



### 二、创建数据表

#### 1、创建app

```
(project1207_venv) D:\20201207\YWproject>django-admin startapp app01
```

#### 2、创建用户信息表 

##### app01/models.py

```
# 用户信息表
class UserInfo(models.Model):
    name = models.CharField(max_length=20)
    password = models.CharField(max_length=25)
    level = models.IntegerField()
```

#### 3、生成数据表

```
> python manage.py makemigrations
> python manage.py migrate

只要表结构有任何修改，都重要重新运行该指令向数据库同步修改
```

```
注意: 

	1、表名的规则		
		app_类名小写
		
	2、django在创建表时，会自动为表生成一个名称为id的主键


```



### 三、数据管理操作

#### 1、添加数据

##### 方法1) 

```
from django.shortcuts import render, redirect
from django.http import HttpResponse
from app01 import models

# Create your views here.

# 添加数据
def add(request):
    p1 = models.UserInfo(name="Tome", password="333", level=8)
    p1.save()
    return HttpResponse("添加数据")
```

##### 方法2) 

```
# 添加数据
def add(request):
    data = { "name":"Jerry", "password":"sjh", "level":2 }
    models.UserInfo.objects.create(**data)
    return HttpResponse("添加数据")
```

##### 方法3) 

```
# 添加数据
def add(request):
    models.UserInfo.objects.create(name="king", password="777", level=9)
    return HttpResponse("添加数据")
```



#### 2、删除数据

```
# 删除数据
def remove(request):
    models.UserInfo.objects.filter(name="lz").delete()
    return HttpResponse("删除数据")
```



#### 3、更新数据

```
# 更新数据
def update(request):
    models.UserInfo.objects.filter(name="Jerry").update(password="555")
    return HttpResponse("更新数据")
```



#### 4、查询数据

##### 1) 查询所有数据

```
models.类名.objects.all()

返回列表，列表中的所有的数据对象
```

```
def test1(request):
    data = models.UserInfo.objects.all()
    print(data)
    user_obj = data[0]
    print(user_obj)
    print(user_obj.name, user_obj.password, user_obj.level)
    print("----------" * 10)
    for obj in data:
        print("用户名: %s, 密码: %s, 级别: %s" % (obj.name, obj.password, obj.level))
    return HttpResponse("查询所有数据")
```

##### 展示数据到前端页面

##### templates/app01/test2.html

```
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>

    <h3>用户信息列表</h3>

    <h4>{{ users }}</h4>

    <table border="1px">
        <tr>
            <td>编号</td>
            <td>用户名</td>
            <td>密码</td>
            <td>级别</td>
        </tr>
        {% for user_obj in users %}
            <tr>
                <td>{{ forloop.counter }}</td>
                <td>{{ user_obj.name }}</td>
                <td>{{ user_obj.password }}</td>
                <td>{{ user_obj.level }}</td>
            </tr>
        {% endfor %}

    </table>

</body>
</html>
```

##### app01/views.py

```
# 查看所有数据，将数据展示到指定的页面
def test2(request):
    users = models.UserInfo.objects.all()
    return render(request, "app01/test2.html", {"users": users})
```



##### 2）按条件查询数据 

###### A) filter( )

```
models.类名.objects.filter(条件)

返回列表、包含符合条件的数据对象
```

```
# 按条件查询数据
def test3(request):
    users = models.UserInfo.objects.filter(level__gte=10)
    print(users)
    for user_obj in users:
        print(user_obj.name, user_obj.password, user_obj.level)
    return HttpResponse("按条件查询")
```

##### 排序	order_by("-字段名称")

```
# 按条件查询数据
def test3(request):
    users = models.UserInfo.objects.filter(level__gte=5).order_by("-level")
    print(users)
    for user_obj in users:
        print(user_obj.name, user_obj.password, user_obj.level)
    return HttpResponse("按条件查询")
```

##### 限制结果的行数

```
    users = models.UserInfo.objects.filter(level__gte=5).last()
    users = models.UserInfo.objects.filter(level__gte=5).first()
```

###### B）get( )

```
filter()方法返回列表、get()直接返回数据对象 

get()只适合做等值条件查询

数据不存在，返回错误 
```

```
user_obj = models.UserInfo.objects.get(name="Tme")
```





##### 3) 按字段查询数据 

###### A) values(字段名称，字段名称)

```
返回列表，列表中包含一个或多个字典，[{"字段名称":"数据"}]
```

```
# 按字段查询数据  values()
def test4(request):
    data = models.UserInfo.objects.values("name", "level")
    print(data)
    for info in data:
        print("用户名: %s, 级别: %s" % (info.get("name"), info.get("level")))
    return HttpResponse("values()")
```



###### B）values_list(字段名称，字段名称)

```
data = models.UserInfo.objects.values_list("name", "level")

返回列表，列表中包含一个或多个元组，[(字段数据,字段数据),()]
```



























