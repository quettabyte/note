## 文件IO

### 一、文件IO操作流程

```
1、创建文件对象/打开文件

	变量 = open(file, mode="r")
		打开模式mode:
			1、读取模式	r    rb
			2、写入模式	w	 wb
				打开存在的文件时，文件内容会被清空覆盖
				适用于新建文件
			3、读写模式	r+
			4、追加模式	a
			
2、读写操作
3、关闭文件
```



#### 1、读取模式  r

```
read()	默认读取文件中所有数据
```

```
file_name = r"D:\20201207\project1207\files\test01"

fobj = open(file_name, mode="r")
data_01 = fobj.read()
data_02 = fobj.read()
fobj.close()

print(data_01)
print(type(data_01))
print("----------" * 10)

print(data_02)
```

```
file_name = r"D:\20201207\project1207\files\test01"

fobj = open(file_name, mode="r")
data_01 = fobj.read(3)
data_02 = fobj.read(4)
fobj.close()

print(data_01)
print(type(data_01))

print("----------" * 10)

print(data_02)
```

#### 2、读取模式 rb 

```
file_name = r"D:\20201207\project1207\files\test01"

fobj = open(file_name, mode="rb")
data_01 = fobj.read()
fobj.close()

print(data_01)
print(type(data_01))
```

##### 1、tell( )		返回光标的当前位置

```
file_name = r"D:\20201207\project1207\files\test01"

fobj = open(file_name, mode="rb")

start = fobj.tell()
print("起始位置: %s" % start)

data_01 = fobj.read()

stop = fobj.tell()
print("最后位置: %s" % stop)

fobj.close()

print(data_01)
print(type(data_01))
```

##### 2、seek( )	移动光标 

```
seek(n, m)
	n: 正数、负数	正数向后移动、负数向前移动 
	m: 0 1 2
		0: 先将光标移动到文件起始处
		1: 保持光标当前位置不动
		2: 先将光标移动到文件末尾处
```

```
fobj.seek(-4, 2)
```



#### 3、遍历文件对象 

```
file_name = r"D:\20201207\project1207\files\test01"

fobj = open(file_name, mode="r")

for line in fobj:
    print("---> %s" % line)
```



#### 4、写入模式	w

```
file_name = r"D:\20201207\project1207\files\test02.txt"

fobj = open(file_name, mode="w")

fobj.write("python\n")
fobj.write("shell\n")

fobj.close()
```



#### 5、打开文件的另外一种写法

```
with open(file, mode="r") as 文件对象:
	读写操作
	读写操作
	
操作执行完毕后，会自动关闭文件！！！！！！！！！！！！！！！
```

```
file_name = r"D:\20201207\project1207\files\test01"

with open(file_name, mode="r") as fobj:
    for line in fobj:
        print("---> %s" % line, end="")

print(fobj.closed)
```



#### 示例1: 统计web日志UV

```
web_log = r"D:\20201207\project1207\files\access_log"

# 获取所有客户端地址
ip_list = []
with open(web_log, mode="r") as fobj:
    for line in fobj:
        client_ip = line.split()[0]
        ip_list.append(client_ip)

# 统计IP地址的次数
for ip in frozenset(ip_list):
    print("客户端地址: %s, 次数: %s" % (ip, ip_list.count(ip)))
```



#### 示例2: 实现文件内容替换  

```
import shutil
import os

file_name = r"D:\20201207\project1207\files\test02.txt"

# 创建临时文件
temp_file = r"D:\20201207\project1207\files\test02_temp.txt"
temp_obj = open(temp_file, mode="w")

with open(file_name, mode="r") as fobj:
    for line in fobj:
        if "shell" in line:
            new_line = line.replace("shell", "Python")
            temp_obj.write(new_line)
        else:
            temp_obj.write(line)

temp_obj.close()

shutil.copy(temp_file, file_name)
os.remove(temp_file)
```



#### 示例3: 实时跟踪日志输出，将带有error的行写入新文件 

```
import time

log_file = r"D:\20201207\project1207\files\test03.log"

# 创建新日志文件
new_log_file = r"D:\20201207\project1207\files\test03_new.log"
new_log_obj = open(new_log_file, mode="wb")

# 打开文件，获取光标最后的位置
with open(log_file, mode="rb") as fobj:
    fobj.seek(0, 2)
    old_position = fobj.tell()

    # 循环，不停向后移动光标，判断文件是否多出内容
    while True:
        fobj.seek(0, 2)
        new_position = fobj.tell()
        if new_position > old_position:
            offset = old_position - new_position
            fobj.seek(offset, 2)
            line = fobj.read()
            # print(line)
            # 检查新内容中是否包含error
            if b"error" in line:
                new_log_obj.write(line)
                new_log_obj.flush()
            old_position = new_position
        time.sleep(1)
```

































