## 文件目录处理模块

### 一、os模块

#### 1、切换目录

```
>>> os.chdir("/etc")
>>> os.getcwd()
'/etc'
```

#### 2、查看当前目录

```
>>> os.getcwd()
'/root'
>>> 
```

#### 3、查看目录下的文件

```
>>> os.listdir("/home")
['martin', 'userA']
```

#### 4、重命名

```
>>> os.rename("/tmp/a.txt", "/tmp/a_new.txt")
```

#### 5、删除文件

```
>>> os.remove("/tmp/a_new.txt")
```

#### 6、创建目录

```
>>> os.mkdir("/tmp/testdir")
>>> 
>>> os.makedirs("/tmp/linux/python")

```

#### 7、递归查看目录下的文件

```
os.walk()直接返回生成器对象，可通过for循环查看数据 

>>> import os
>>>
>>> result = os.walk(r"D:\20201207\project1207\files")
>>> result
<generator object walk at 0x00000144BADF2270>
>>>
>>> for i in result:
...    print(i)
...
('D:\\20201207\\project1207\\files', ['AA', 'BB'], ['access_log', 'test01', 'test02.txt', 'test03.log', 'test03_new.log', 'test04.txt'])
('D:\\20201207\\project1207\\files\\AA', ['A01'], ['a001', 'a002'])
('D:\\20201207\\project1207\\files\\AA\\A01', [], ['aaaa'])
('D:\\20201207\\project1207\\files\\BB', ['B01'], [])
('D:\\20201207\\project1207\\files\\BB\\B01', [], [])
```

##### 获取目录下所有文件的绝对路径 

```
import os

directory = r"D:\20201207\project1207\files"

for dir_name, sub_dir_list, file_name_list in os.walk(directory):
    if len(file_name_list) > 0:
        for f_name in file_name_list:
            full_file_name = dir_name + "\\" + f_name
            print(full_file_name)
```

#### 8、调用shell命令

##### 1) os.popen( )	获取命令的执行结果 

```
import os

result = os.popen("ping baidu.com")
print(result)				# 返回特殊文件
print(result.read())		# 获取命令结果 
```

##### 2) subprocess模块

```
subprocess.call( )		//返回命令的执行状态码
```

```
import os
import subprocess

null_file = open("win32_null_file", mode="wb")
result = subprocess.call("ping baidu.com", shell=True, stdout=null_file, stderr=null_file)
print(result)
print(type(result))

null_file.close()
```



#### 示例1： 批量重命名

```
import os

directory = r"D:\20201207\project1207\files"

for dir_name, sub_dir_list, file_name_list in os.walk(directory):
    if len(file_name_list) > 0:
        for f_name in file_name_list:
            full_file_name = dir_name + "\\" + f_name
            if full_file_name.endswith(".txt"):
                new_file_name = full_file_name.replace("txt", "html")
                os.rename(full_file_name, new_file_name)
```



#### 示例2: 检测网段在线主机 

```
import subprocess

null_file = open("win32_null_file", mode="wb")

for i in range(1, 255):
    ping_cmd = "ping -w 1 -n 1 192.168.140.%s" % i
    result = subprocess.call(ping_cmd, shell=True, stdout=null_file, stderr=null_file)
    if result == 0:
        print("Host 192.168.140.%s is up" % i)

null_file.close()
```



#### 9、判断文件目录是否存在

```
>>> os.path.exists("/etc/fstab")
True
>>> os.path.exists("/etc/")
True

```

#### 10、判断文件类型

```
>>> os.path.isdir("/etc")
True
>>> os.path.isfile("/etc/fstab")
True

```

#### 11、获取文件所在路径、文件名称 

```
>>> os.path.dirname("/etc/sysconfig/network")
'/etc/sysconfig'
>>> 
>>> os.path.basename("/etc/sysconfig/network")
'network'
```



### 二、shutil模块

#### 1、复制文件	shutil.copy()

```
>>> import shutil
>>> 
>>> shutil.copy("/etc/fstab", "/tmp/fstab")

```

#### 2、删除目录

```
import shutil
shutil.rmtree(r"D:\20201207\project1207\files\BB")
```



### 三、hashlib模块 

```
实现文件MD5校验
```

```
>>> import hashlib
>>> md5_tool = hashlib.md5()
>>> md5_tool.update(b"abc")
>>> md5_tool.update(b"123")
>>>
>>> md5_tool.hexdigest()
'e99a18c428cb38d5f260853678922e03'
>>>
```

##### 实现文件内容MD5校验

```
import hashlib

file_name = r"D:\20201207\project1207\files\test03.log"

md5_tools = hashlib.md5()

with open(file_name, mode="rb") as fobj:
    while True:
        data = fobj.read(4096)
        if data:
            md5_tools.update(data)
        else:
            break

print("文件%s的MD5校验码: %s" % (file_name, md5_tools.hexdigest()))
```



### 四、tarfile模块

```
实现文件打包备份	.tar.gz, .tar.bz2
```

```
import tarfile

tar_file_name = r"D:\20201207\project1207\testdir\data.tar.gz"

tar_obj = tarfile.open(tar_file_name, mode="w:gz")

tar_obj.add(r"D:\20201207\project1207\files\test02.html")
tar_obj.add(r"D:\20201207\project1207\files\test03.log")
tar_obj.add(r"D:\20201207\project1207\files\test03_new.log")

tar_obj.close()
```



### 五、pickle模块

```
实现数据持久化存储
保持数据类型不变
```

#### 1、dump(object, file)		写入数据 

```
import pickle

data = { "user":"Martin", "pwd": "redhat" }

file_name = r"D:\20201207\project1207\files\test05"

with open(file_name, mode="wb") as fobj:
    pickle.dump(data, fobj)  # 字典 ---> pickle格式 -----> 写入文件
```

#### 2、load(file)

```
import pickle

file_name = r"D:\20201207\project1207\files\test05"

with open(file_name, mode="rb") as fobj:
    data = pickle.load(fobj)
    print(type(data))
    print(data)
```







