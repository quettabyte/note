## 网卡聚合/绑定

### 一、介绍

```
作用:
	提高带宽、高可用
	
聚合的方式:
	team
```

### 聚合模式

```
1、roundrobin
	
	负载均衡模式, 提高带宽
	需要交换机配置以太网通道 

2、activebackup		
	主备模式 
```

#### 配置绑定

##### 1、删除网卡现有配置

```
[root@master ~]# nmcli connection show 
NAME                UUID                                  TYPE      DEVICE 
ens33               c96bc909-188e-ec64-3a96-6a90982b08ad  ethernet  ens33  
Wired connection 1  816a5da9-8280-3cf1-812f-19961ef9fadf  ethernet  ens37  
Wired connection 2  89f288e3-bc52-3eca-8194-0a3951ac66d2  ethernet  ens38  
 
[root@master ~]# nmcli connection delete Wired\ connection\ 1 
Connection 'Wired connection 1' (816a5da9-8280-3cf1-812f-19961ef9fadf) successfully deleted.
[root@master ~]# nmcli connection delete Wired\ connection\ 2 
Connection 'Wired connection 2' (89f288e3-bc52-3eca-8194-0a3951ac66d2) successfully deleted.

```

##### 2、创建绑定网卡  team1

```
[root@master ~]# nmcli connection add type team ifname team1 con-name team1 config '{"runner":{"name":"activebackup"}}'

```

##### 3、指定物理网卡

```
[root@master ~]# nmcli connection add type team-slave ifname ens37 con-name team1-ens37 master team1
Connection 'team1-ens37' (36cf8f49-972d-4fc9-be50-9a084a656cb8) successfully added.

[root@master ~]# nmcli connection add type team-slave ifname ens38 con-name team1-ens38 master team1 
Connection 'team1-ens38' (dda1db0c-3fa0-4178-9d44-90361b072333) successfully added.
```

##### 4、配置网络参数

```
[root@master ~]# nmcli connection modify team1 ipv4.addresses "192.168.140.100/24"
[root@master ~]# nmcli connection modify team1 ipv4.gateway "192.168.140.2"
[root@master ~]# nmcli connection modify team1 ipv4.dns "114.114.114.114"
[root@master ~]# nmcli connection modify team1 +ipv4.dns "4.4.4.4"
[root@master ~]# 
[root@master ~]# nmcli connection modify team1 ipv4.method manual 
[root@master ~]# 
[root@master ~]# nmcli connection reload 
[root@master ~]# nmcli connection up team1
```

##### 5、查看聚合网卡的状态 

```
[root@master ~]# teamdctl team1 state
setup:
  runner: activebackup
ports:
  ens37
    link watches:
      link summary: up
      instance[link_watch_0]:
        name: ethtool
        link: up
        down count: 0
  ens38
    link watches:
      link summary: up
      instance[link_watch_0]:
        name: ethtool
        link: up
        down count: 0
runner:
  active port: ens37

```





## tcpdump抓包工具

#### 1、常用选项

```
根据网络数据五元素抓取
```

##### 1) 抓取ping包

```
[root@master ~]# tcpdump -i ens33 -nn icmp 

	icmp
	vrrp
```

##### 2）host

```
根据源IP、目的IP抓取数据
```

```
[root@master ~]# tcpdump -i ens33 -nn icmp and host 192.168.140.11 
```

```
[root@master ~]# tcpdump -i ens33 -nn icmp and src host 192.168.140.11 
```

```
[root@master ~]# tcpdump -i ens33 -nn icmp and dst host 192.168.140.11 
```

##### 3) port

```
根据端口号抓取数据 
```

```
[root@master ~]# tcpdump -i ens33 -nn host 192.168.140.11 and port 80 
tcpdump: verbose output suppressed, use -v or -vv for full protocol decode
listening on ens33, link-type EN10MB (Ethernet), capture size 262144 bytes

15:29:17.899950 IP 192.168.140.11.42356 > 192.168.140.10.80: Flags [S], seq 1423321460, win 29200, options [mss 1460,sackOK,TS val 167530 ecr 0,nop,wscale 7], length 0
15:29:17.899981 IP 192.168.140.10.80 > 192.168.140.11.42356: Flags [S.], seq 1878701548, ack 1423321461, win 28960, options [mss 1460,sackOK,TS val 5514262 ecr 167530,nop,wscale 7], length 0
15:29:17.900224 IP 192.168.140.11.42356 > 192.168.140.10.80: Flags [.], ack 1, win 229, options [nop,nop,TS val 167531 ecr 5514262], length 0
15:29:17.900365 IP 192.168.140.11.42356 > 192.168.140.10.80: Flags [P.], seq 1:79, ack 1, win 229, options [nop,nop,TS val 167531 ecr 5514262], length 78: HTTP: GET / HTTP/1.1


	S：SYN
	.: ACK
```

```
[root@master ~]# tcpdump -i ens33 -nn src host 192.168.140.11 and dst port 80 
```

```
[root@master ~]# tcpdump -i ens33 -nn host 192.168.140.11 and src port 80 
```

#### 4) -w 另存为

```
[root@master ~]# tcpdump -i ens33 -nn host 192.168.140.11 and port 3306 -w /tmp/mysql.data
```









