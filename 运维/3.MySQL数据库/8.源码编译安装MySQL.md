### 源码编译MySQL

规则: 

​		数据目录		/mysql/data		逻辑卷 

​		二进制日志	/mysql/log			



#### 1、规则数据目录、二进制日志目录 

```
[root@localhost ~]# df -hT | grep mysql
/dev/mapper/mysql-data  ext4       15G   41M   14G    1% /mysql/data
/dev/sdc                ext4       20G   45M   19G    1% /mysql/log

[root@localhost ~]# rm -rf /mysql/data/* /mysql/log/*
```



#### 2、卸载系统自带的mariadb相关软件 

```
[root@localhost ~]# rpm -qa | grep mariadb
mariadb-libs-5.5.56-2.el7.x86_64
[root@localhost ~]# 
[root@localhost ~]# rpm -e --nodeps mariadb-libs
```



#### 3、创建mysql用户，将数据目录、日志目录的所属修改为mysql  

```
[root@localhost ~]# useradd -s /sbin/nologin -M mysql
[root@localhost ~]# chown -R mysql.mysql /mysql/data/
[root@localhost ~]# chown -R mysql.mysql /mysql/log/
```



#### 4、安装cmake编译器 

```
[root@localhost ~]# yum install -y gcc cmake 
```





#### 5、配置MySQL安装参数 

```
[root@localhost ~]# tar xf mysql-boost-5.7.17.tar.gz 
[root@localhost ~]# cd mysql-5.7.17/
[root@localhost mysql-5.7.17]# cmake . \
> -DCMAKE_INSTALL_PREFIX=/usr/local/mysql57 \
> -DMYSQL_UNIX_ADDR=/tmp/mysql.sock \
> -DDEFAULT_CHARSET=utf8 \
> -DDEFAULT_COLLATION=utf8_general_ci \
> -DMYSQL_DATADIR=/mysql/data \
> -DMYSQL_TCP_PORT=3306 \
> -DWITH_BOOST=boost/boost_1_59_0/ \
> -DWITH_MYISAM_STORAGE_ENGINE=1 \
> -DWITH_INNOBASE_STORAGE_ENGINE=1 \
> -DWITH_ARCHIVE_STORAGE_ENGINE=1 \
> -DWITH_BLACKHOLE_STORAGE_ENGINE=1

[root@localhost mysql-5.7.17]# make
[root@localhost mysql-5.7.17]# make install 

错误1：  Curses library not found.  Please install appropriate package,
解决办法: 
[root@localhost mysql-5.7.17]# yum install -y ncurses-devel 

错误2: cmake报内部错误  
[root@localhost mysql-5.7.17]# yum groupinstall -y "Development Tools" "Server platform Development" "Desktop Platform Development" 
```



#### 6、修改mysql安装目录的所属  

```
[root@localhost ~]# chown -R root.mysql /usr/local/mysql57/
```



#### 7、初始化MySQL

```
[root@localhost ~]# /usr/local/mysql57/bin/mysqld --initialize --user=mysql --basedir=/usr/local/mysql57 --datadir=/mysql/data 

2021-01-20T08:10:49.294942Z 1 [Note] A temporary password is generated for root@localhost: fLko(-i3_s<z

[root@localhost ~]# ls /mysql/data/
auto.cnf  ib_buffer_pool  ibdata1  ib_logfile0  ib_logfile1  mysql  performance_schema  sys
[root@localhost ~]# 
```



#### 8、编辑配置文件

```
[root@localhost ~]# cp /usr/local/mysql57/support-files/my-default.cnf /etc/my.cnf
[root@localhost ~]# vim /etc/my.cnf 
[mysqld]

log_bin = /mysql/log/master
default_storage_engine = InnoDB

basedir = /usr/local/mysql57
datadir = /mysql/data
port = 3306
server_id = 10
socket = /tmp/mysql.sock
```



#### 9、复制MySQL服务控制脚本 

```
[root@localhost ~]# cp /usr/local/mysql57/support-files/mysql.server /etc/init.d/mysqld
[root@localhost ~]# chmod a+x /etc/init.d/mysqld
```



#### 10、启动mysql服务 

```
[root@localhost ~]# /etc/init.d/mysqld start
Starting MySQL.Logging to '/mysql/data/localhost.err'.
 SUCCESS! 
[root@localhost ~]# netstat -antp | grep mysql
tcp6       0      0 :::3306                 :::*                    LISTEN      51484/mysqld        
[root@localhost ~]# 
[root@localhost ~]# ps -elf | grep mysql
4 S root      51290      1  0  80   0 - 28353 do_wai 16:18 pts/0    00:00:00 /bin/sh /usr/local/mysql57/bin/mysqld_safe --datadir=/mysql/data --pid-file=/mysql/data/localhost.pid
4 S mysql     51484  51290  1  80   0 - 441963 poll_s 16:18 pts/0   00:00:00 /usr/local/mysql57/bin/mysqld --basedir=/usr/local/mysql57 --datadir=/mysql/data --plugin-dir=/usr/local/mysql57/lib/plugin --user=mysql --log-error=/mysql/data/localhost.err --pid-file=/mysql/data/localhost.pid --socket=/tmp/mysql.sock --port=3306
```



#### 11、修改root密码 

```
[root@localhost ~]# vim /etc/profile
export PATH=$PATH:/usr/local/mysql57/bin

[root@localhost ~]# source /etc/profile
```

```
[root@localhost ~]# mysqladmin -u root -p password "redhat"
Enter password: 

[root@localhost ~]# mysql -uroot -predhat
mysql: [Warning] Using a password on the command line interface can be insecure.
Welcome to the MySQL monitor.  Commands end with ; or \g.
Your MySQL connection id is 4
Server version: 5.7.17-log Source distribution

Copyright (c) 2000, 2016, Oracle and/or its affiliates. All rights reserved.

Oracle is a registered trademark of Oracle Corporation and/or its
affiliates. Other names may be trademarks of their respective
owners.

Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.

mysql> 
mysql> 
```











