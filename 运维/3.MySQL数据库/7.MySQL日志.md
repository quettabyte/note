## MySQL日志 

### 一、MySQL日志

```
二进制日志 binary log 
慢查询日志
错误日志 
```



### 二、二进制日志  binary log 

```
作用: 记录数据库产生的所有写操作 

应用: 
	1、数据备份、恢复; 即时点还原 
	2、主从复制架构
```

```
启用二进制日志 

[mysqld]
server_id=10
log_bin=/test/master

二进制日志默认保存数据目录下 
	master.000001	二进制日志文件 
	master.index	所有二进制日志文件名称 
	
[root@localhost ~]# cat /var/lib/mysql/master.index 
./master.000001
./master.000002

```

```
事件格式: 
	事件、起始时间、终止时间、起始位置、终止位置
```

```
查看二进制日志文件内容 	mysqlbinlog

1、查看所有内容 
[root@localhost ~]# mysqlbinlog /test/master.000002 

--start-datetime=
--stop-datetime=

[root@localhost ~]# mysqlbinlog --start-datetime="2021-01-20 11:01:22"  --stop-datetime="2021-01-20 11:12:18" /test/master.000002

--start-position=
--stop-position=

[root@localhost ~]# mysqlbinlog --start-position=219 --stop-position=313 /test/master.000002 
```



```
1、查看所有的二进制日志文件 

mysql> show binary logs;
+---------------+-----------+
| Log_name      | File_size |
+---------------+-----------+
| master.000001 |       177 |
| master.000002 |       495 |
| master.000003 |       313 |
+---------------+-----------+
3 rows in set (0.00 sec)

2、查看当前正在使用的二进制日志文件 

mysql> show master status;
+---------------+----------+--------------+------------------+-------------------+
| File          | Position | Binlog_Do_DB | Binlog_Ignore_DB | Executed_Gtid_Set |
+---------------+----------+--------------+------------------+-------------------+
| master.000003 |      475 |              |                  |                   |
+---------------+----------+--------------+------------------+-------------------+
1 row in set (0.00 sec)


3、查看二进制日志文件中的事件 

mysql> show binlog events in 'master.000002';
+---------------+-----+----------------+-----------+-------------+---------------------------------------+
| Log_name      | Pos | Event_type     | Server_id | End_log_pos | Info                                  |
+---------------+-----+----------------+-----------+-------------+---------------------------------------+
| master.000002 |   4 | Format_desc    |        10 |         123 | Server ver: 5.7.17-log, Binlog ver: 4 |
| master.000002 | 123 | Previous_gtids |        10 |         154 |                                       |
| master.000002 | 154 | Anonymous_Gtid |        10 |         219 | SET @@SESSION.GTID_NEXT= 'ANONYMOUS'  |
| master.000002 | 219 | Query          |        10 |         313 | create database db01                  |
| master.000002 | 313 | Anonymous_Gtid |        10 |         378 | SET @@SESSION.GTID_NEXT= 'ANONYMOUS'  |
| master.000002 | 378 | Query          |        10 |         472 | create database db02                  |
| master.000002 | 472 | Stop           |        10 |         495 |                                       |
+---------------+-----+----------------+-----------+-------------+---------------------------------------+
7 rows in set (0.00 sec)
```



```
二进制日志文件滚动

1、重启mysql服务

2、手动生成

mysql> flush logs;

3、单个二进制日志文件超过1G 

```



### 三、慢查询日志

```
作用: 记录数据库产生的慢查询 

慢查询: 
	超过long_query_time指定时间的查询， 默认10秒 
	
查看long_query_time变量的值 

mysql> select @@long_query_time;
+-------------------+
| @@long_query_time |
+-------------------+
|         10.000000 |
+-------------------+
1 row in set (0.00 sec)
```

```
启用慢查询日志 

[mysqld]
long_query_time=5
slow_query_log=ON
slow_query_log_file=slow.log

mysql> select sleep(6);
+----------+
| sleep(6) |
+----------+
|        0 |
+----------+
1 row in set (6.00 sec)
```



```
查看变量的值  

mysql> select @@default_storage_engine;
+--------------------------+
| @@default_storage_engine |
+--------------------------+
| InnoDB                   |
+--------------------------+
1 row in set (0.00 sec)

查看所有变量 
mysql> show global variables;

mysql> show global variables like "%slow%";
```



### 四、错误日志 

```
/var/log/mysqld.log 

mysql> select @@log_error;
+---------------------+
| @@log_error         |
+---------------------+
| /var/log/mysqld.log |
+---------------------+
1 row in set (0.00 sec)

```

































