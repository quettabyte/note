## 用户权限管理操作   DCL 

### 一、用户管理操作

```
用户格式: 

	用户名@客户端地址 

	客户端地址: 
		1、IP地址  	 admin@192.168.1.1 
		2、本地登录	    admin@localhost
        3、主机名		admin@node01.linux.com 
        4、网段		 admin@192.168.1.% 
        5、所有主机		admin@% 	
```

```
mysql数据库、user表

字段结构: 
	user, host, authentication_string
mysql> select user, host from mysql.user;
+-----------+-----------+
| user      | host      |
+-----------+-----------+
| mysql.sys | localhost |
| root      | localhost |
+-----------+-----------+
2 rows in set (0.00 sec)

mysql> select user, host, authentication_string from mysql.user;
+-----------+-----------+-------------------------------------------+
| user      | host      | authentication_string                     |
+-----------+-----------+-------------------------------------------+
| root      | localhost | *F00AFD2CA41EF081905BE7FC7051A0D3D53B49AD |
| mysql.sys | localhost | *THISISNOTAVALIDPASSWORDTHATCANBEUSEDHERE |
+-----------+-----------+-------------------------------------------+
2 rows in set (0.00 sec)

```



#### 1、创建用户 

```
语法: 
> create user '用户名'@'客户端地址' identified by '密码'
```

```
示例1: 创建允许本地登录的用户，名称为admin 

mysql> create user 'admin'@'localhost' identified by 'WWW.1.com';
Query OK, 0 rows affected (0.08 sec)

mysql> flush privileges;
Query OK, 0 rows affected (0.00 sec)

mysql> select user,host from mysql.user;
+-----------+-----------+
| user      | host      |
+-----------+-----------+
| admin     | localhost |
| mysql.sys | localhost |
| root      | localhost |
+-----------+-----------+
3 rows in set (0.00 sec)

[root@localhost ~]# mysql -u admin -p

mysql> select user();
+-----------------+
| user()          |
+-----------------+
| admin@localhost |
+-----------------+
1 row in set (0.00 sec)

mysql> 
mysql> show databases;
+--------------------+
| Database           |
+--------------------+
| information_schema |
+--------------------+
1 row in set (0.00 sec)

```



```
示例2: 创建允许192.168.183.12远程连接的用户 

mysql> create user 'admin'@'192.168.183.12' identified by 'WWW.1.com';
Query OK, 0 rows affected (0.01 sec)

mysql> flush privileges;
Query OK, 0 rows affected (0.00 sec)

mysql> select user,host from mysql.user;
+-----------+----------------+
| user      | host           |
+-----------+----------------+
| admin     | 192.168.183.12 |
| admin     | localhost      |
| mysql.sys | localhost      |
| root      | localhost      |
+-----------+----------------+
4 rows in set (0.00 sec)

远程连接数据库
> mysql -u 用户名 -p -h 数据库服务器地址 
```



```
示例3: 创建允许windows连接的远程用户 

mysql> create user 'admin'@'192.168.183.1' identified by 'WWW.1.com';
Query OK, 0 rows affected (0.00 sec)

mysql> flush privileges;
Query OK, 0 rows affected (0.00 sec)
```



#### 2、删除用户 

```
> drop user 用户名 

mysql> drop user 'admin'@'localhost';
Query OK, 0 rows affected (0.00 sec)

mysql> flush privileges;
Query OK, 0 rows affected (0.00 sec)

mysql> select user,host from mysql.user;
+-----------+----------------+
| user      | host           |
+-----------+----------------+
| admin     | 192.168.183.1  |
| admin     | 192.168.183.12 |
| mysql.sys | localhost      |
| root      | localhost      |
+-----------+----------------+
4 rows in set (0.00 sec)

```



#### 3、修改用户密码 

```
方法1: mysqladmin 	适用于修改本地用户密码 

[root@localhost ~]# mysqladmin -u martin -p password "WWW.2.com"
Enter password: 
```



```
方法2:  set password for

mysql> set password for 'admin'@'192.168.183.12' = PASSWORD("WWW.2.com");
Query OK, 0 rows affected, 1 warning (0.00 sec)

mysql> flush privileges;
Query OK, 0 rows affected (0.00 sec)
```



```
方法3: update  

mysql> update mysql.user set authentication_string=PASSWORD("WWW.3.com") where user='admin' and host='192.168.183.12';
Query OK, 1 row affected, 1 warning (0.00 sec)
Rows matched: 1  Changed: 1  Warnings: 1

mysql> flush privileges;
Query OK, 0 rows affected (0.00 sec)

mysql> exit
Bye
```





#### 4、重置root密码 

```
1、编辑my.cnf配置文件 
[mysqld]
skip-grant-tables		//跳过授权表
# systemctl restart mysqld 

2、使用root用户登录数据库，使用update修改密码 

3、将配置文件中跳过授权表的配置删除，重启数据库服务 
```





### 二、用户授权

#### 1、用户授权

```
语法: 

> grant 权限,权限 on 库名.表名 to 用户名 [identified by '密码'] [with grant option]

权限: 
	create, drop, select, delete, update, insert, all 
	
库名.表名: 
	jiaowu.tutors
	jiaowu.*
	*.*
	
mysql> grant select on jiaowu.tutors to 'admin'@'192.168.183.12';
Query OK, 0 rows affected (0.01 sec)

mysql> flush privileges;
Query OK, 0 rows affected (0.00 sec)


mysql> grant select,update on jiaowu.tutors to 'robin'@'localhost' identified by 'WWW.1.com';
Query OK, 0 rows affected, 1 warning (0.00 sec)

mysql> flush privileges;
Query OK, 0 rows affected (0.00 sec)

mysql> select user,host from mysql.user;
+-----------+----------------+
| user      | host           |
+-----------+----------------+
| admin     | 192.168.183.1  |
| admin     | 192.168.183.12 |
| martin    | localhost      |
| mysql.sys | localhost      |
| robin     | localhost      |
| root      | localhost      |
+-----------+----------------+
6 rows in set (0.00 sec)

```



#### 2、查看用户权限

```
> show grants for 用户名 

mysql> show grants for 'robin'@'localhost';
+------------------------------------------------------------------+
| Grants for robin@localhost                                       |
+------------------------------------------------------------------+
| GRANT USAGE ON *.* TO 'robin'@'localhost'                        |
| GRANT SELECT, UPDATE ON `jiaowu`.`tutors` TO 'robin'@'localhost' |
+------------------------------------------------------------------+
2 rows in set (0.00 sec)
```



#### 3、撤销用户权限  

```
语法: 
> revoke 权限,权限 on 库名.表名 from 用户名；

mysql> revoke update on jiaowu.tutors from 'robin'@"localhost";
Query OK, 0 rows affected (0.00 sec)

mysql> flush privileges;
Query OK, 0 rows affected (0.00 sec)

mysql> show grants for 'robin'@"localhost";
+----------------------------------------------------------+
| Grants for robin@localhost                               |
+----------------------------------------------------------+
| GRANT USAGE ON *.* TO 'robin'@'localhost'                |
| GRANT SELECT ON `jiaowu`.`tutors` TO 'robin'@'localhost' |
+----------------------------------------------------------+
2 rows in set (0.00 sec)
```





































