## zabbix监控应用

### 一、zabbix监控介绍

#### 1、获取服务器指标数据的方式 

```
1、手工巡检
2、专业监控软件
	cacti、nagios、zabbix、openfalcon、promethus
```

#### 2、zabbix特性

```
1、开源、跨平台
2、支持监控不同类型的设备
	a) zabbix-agent		适用于主机/服务器监控
	b) snmp协议		   适用于网络设备的监控	v2版本   161/udp
	c) IPMI协议		   适用于监控硬件设备数据(CPU温度)
	d) JMX协议		   适用于监控java应用程序
3、支持多种不同的报警方式，邮件报警、电话报警、微信报警
4、支持自动发现、自动注册功能
5、支持分布式监控
6、提供web管理界面
7、提供API接口
```



### 二、安装部署zabbix server 

#### 1、关闭防火墙、SELinux、时间同步

#### 2、配置zabbix软件仓库

```
[root@zabbix-server ~]# cat /etc/yum.repos.d/epel.repo 
[epel]
name=epel
baseurl=https://mirrors.tuna.tsinghua.edu.cn/epel/7Server/x86_64/
enabled=1
gpgcheck=0

[root@zabbix-server ~]# cat /etc/yum.repos.d/zabbix.repo 
[zabbix]
name=zabbix
baseurl=https://mirrors.tuna.tsinghua.edu.cn/zabbix/zabbix/4.2/rhel/7/x86_64/
enabled=1
gpgcheck=0

```

#### 3、安装zabbix server服务端软件

```
[root@zabbix-server ~]# yum install -y zabbix-server-mysql zabbix-web-mysql 
```

#### 4、配置MySQL

```
[root@zabbix-server ~]# yum install -y mariadb-server 
[root@zabbix-server ~]# clear
[root@zabbix-server ~]# systemctl start mariadb
[root@zabbix-server ~]# systemctl enable mariadb

MariaDB [(none)]> create database zabbix charset utf8 collate utf8_bin;
Query OK, 1 row affected (0.00 sec)

MariaDB [(none)]> grant all on zabbix.* to 'zabbixuser'@"localhost" identified by 'redhat';
Query OK, 0 rows affected (0.00 sec)

MariaDB [(none)]> flush privileges;
Query OK, 0 rows affected (0.00 sec)
```

#### 5、导入zabbix需要的表

```
[root@zabbix-server ~]# cd /usr/share/doc/zabbix-server-mysql-4.2.8/
[root@zabbix-server zabbix-server-mysql-4.2.8]# zcat create.sql.gz | mysql -u root zabbix
```

#### 6、编辑zabbix server配置文件

```
[root@zabbix-server ~]# vim /etc/zabbix/zabbix_server.conf 
DBHost=localhost
DBName=zabbix
DBUser=zabbixuser
DBPassword=redhat
DBSocket=/var/lib/mysql/mysql.sock

```

#### 7、启动zabbix server

```
[root@zabbix-server ~]# systemctl start zabbix-server.service 
[root@zabbix-server ~]# systemctl enable zabbix-server.service

[root@zabbix-server ~]# netstat -antp | grep zabbix
tcp        0      0 0.0.0.0:10051           0.0.0.0:*               LISTEN      7855/zabbix_server  
tcp6       0      0 :::10051                :::*                    LISTEN      7855/zabbix_server  

```

#### 8、访问web管理界面 

```
[root@zabbix-server ~]# vim /etc/httpd/conf.d/zabbix.conf 

       php_value date.timezone Asia/shanghai

[root@zabbix-server ~]# systemctl start httpd

[root@zabbix-server ~]# systemctl enable httpd
```

```
http://192.168.140.10/zabbix

默认用户名: Admin， 密码: zabbix
```





### 三、配置本机监控

#### 1、安装zabbix-agent

```
[root@zabbix-server ~]# yum install -y zabbix-agent 
```

#### 2、编辑zabbix agent的配置文件

```
zabbix-agent的工作模式:
	主动模式
	被动模式
```

```
[root@zabbix-server ~]# vim /etc/zabbix/zabbix_agentd.conf 

Server=192.168.140.10			//被动模式下，zabbix server的地址
ServerActive=192.168.140.10		//主动模式下, zabbix server的地址
Hostname=Zabbix server			//指定被监控端的名称、要惟一
```

#### 3、启动zabbix agent

```
[root@zabbix-server ~]# systemctl start zabbix-agent
[root@zabbix-server ~]# systemctl enable zabbix-agent

[root@zabbix-server ~]# netstat -antp | grep zabbix
tcp        0      0 0.0.0.0:10050           0.0.0.0:*               LISTEN      19236/zabbix_agentd 
```

#### 4、在web管理界面修改被监控机的配置

![image-20210312151237227](C:\Users\admin\AppData\Roaming\Typora\typora-user-images\image-20210312151237227.png)



![image-20210312151425984](C:\Users\admin\AppData\Roaming\Typora\typora-user-images\image-20210312151425984.png)



#### 5、解决图形乱码的问题

```
[root@zabbix-server ~]# wget http://y.downya.com/soft/simkai_downyi.com.zip
[root@zabbix-server ~]# unzip simkai_downyi.com.zip 

1、将simkai.ttf拷贝到zabbix存放字体文件的目录 

[root@zabbix-server ~]# cp simkai.ttf /usr/share/zabbix/assets/fonts/
[root@zabbix-server ~]# ls /usr/share/zabbix/assets/fonts/
graphfont.ttf  simkai.ttf

2、编辑显示图形的配置文件

[root@zabbix-server ~]# vim /usr/share/zabbix/include/defines.inc.php 

define('ZBX_GRAPH_FONT_NAME',           'simkai'); // font file name
define('ZBX_FONT_NAME', 'simkai');
```

![image-20210312152641409](C:\Users\admin\AppData\Roaming\Typora\typora-user-images\image-20210312152641409.png)











