## 分布式监控

### 一、介绍

![image-20210317141852043](C:\Users\admin\AppData\Roaming\Typora\typora-user-images\image-20210317141852043.png)

```
1、zabbix proxy仅收集数据，所有其他工作还要由server发起
2、工作模式
	主动
	被动
```



### 二、部署zabbix proxy

#### 1、安装软件

```
[root@zabbix_proxy ~]# yum install -y zabbix-proxy-mysql 
```

#### 2、安装MySQL

```
MariaDB [(none)]> create database zabbixproxy charset utf8 collate utf8_bin;
Query OK, 1 row affected (0.00 sec)

MariaDB [(none)]> grant all on zabbixproxy.* to 'proxyuser'@'localhost' identified by 'redhat';
Query OK, 0 rows affected (0.00 sec)

MariaDB [(none)]> flush privileges;
Query OK, 0 rows affected (0.00 sec)

```

#### 3、导入zabbix proxy需要的表

```
[root@zabbix_proxy ~]# ls /usr/share/doc/zabbix-proxy-mysql-4.2.8/

[root@zabbix_proxy ~]# cd /usr/share/doc/zabbix-proxy-mysql-4.2.8/
[root@zabbix_proxy zabbix-proxy-mysql-4.2.8]# zcat schema.sql.gz | mysql -uroot zabbixproxy

```



#### 4、编辑配置文件

```
[root@zabbix_proxy ~]# vim /etc/zabbix/zabbix_proxy.conf 

Server=192.168.140.10
Hostname=zabbix_proxy.linux.com
DBHost=localhost
DBName=zabbixproxy
DBUser=proxyuser
DBPassword=redhat
DBSocket=/var/lib/mysql/mysql.sock


```



#### 5、启动zabbix proxy

```
[root@zabbix_proxy ~]# systemctl start zabbix-proxy.service 
[root@zabbix_proxy ~]# systemctl enable zabbix-proxy.service

[root@zabbix_proxy ~]# netstat -antp | grep zabbix
tcp        0      0 0.0.0.0:10051           0.0.0.0:*               LISTEN      17489/zabbix_proxy  
tcp6       0      0 :::10051                :::*                    LISTEN      17489/zabbix_proxy  

```



#### 6、在web管理界面添加代理

![image-20210317143644490](C:\Users\admin\AppData\Roaming\Typora\typora-user-images\image-20210317143644490.png)



#### 7、在被监控端安装部署agent

```
Server=<代理服务器地址>
ServerActive=<代理服务器地址>
Hostname=
```

![image-20210317144331604](C:\Users\admin\AppData\Roaming\Typora\typora-user-images\image-20210317144331604.png)