## expect工具

### 一、expect工具介绍

```
作用: 
	捕获交互式的输出, 自动执行交互式命令 
```

#### 1、spawn命令

```
作用：指定捕获哪个命令的输出

语法:

# spawn 命令
```

#### 2、expect命令

```
作用: 指定捕获的信息

语法:

expect 提示信息
```

#### 3、send命令

```
作用：向交互式命令发送指令

语法:

send 参数
```



#### 案例: 捕获passwd命令的输出，实现自动设置密码 

```
[root@es-master ~]# yum install -y expect

[root@es-master ~]# rpm -q expect
expect-5.45-14.el7_1.x86_64
```

```
[root@es-master ~]# cat /opt/test01
#!/usr/bin/expect

set timeout 3
spawn passwd root
expect "New password:"
send "www.1.com\n"
expect "Retype new password:"
send "www.1.com\n"
expect eof

执行文件:
[root@es-master ~]# expect /opt/test01
```



#### 案例: 结合shell脚本使用

```
[root@es-master ~]# cat /opt/test02.sh 
#!/bin/bash
#

useradd openstack

/usr/bin/expect << eof
set timeout 3
spawn passwd openstack
expect "password:"
send "123\n"
expect "password:"
send "123\n"
expect eof
eof

[root@es-master ~]# bash /opt/test02.sh 
```



#### 案例: 配置免密ssh

```
#!/bin/bash
#

if [ -e ~/.ssh/known_hosts ]; then
    rm -rf ~/.ssh/known_hosts
fi

ssh-keygen -t rsa -N "" -f /root/.ssh/id_rsa &> /dev/null

for i in 11 12; do
/usr/bin/expect << eof
set timeout 5
spawn ssh-copy-id root@192.168.183.$i
expect "(yes/no)?"
send "yes\n"
expect "password:"
send "redhat\n"
expect eof
eof
done
```







## shell数组

### 一、数组介绍

```
一段连续的内存空间
```

#### 1、定义数组

```
方法1: 

[root@es-master ~]# data_01=(1.1.1.1 1.1.1.2 1.1.1.3 1.1.1.4)
```

```
方法2: 

[root@es-master ~]# data_02[1]=martin
[root@es-master ~]# data_02[2]=robin
[root@es-master ~]# data_03[3]=lz
```



#### 2、获取数据

```
[root@es-master ~]# echo ${data_01[*]}
1.1.1.1 1.1.1.2 1.1.1.3 1.1.1.4

[root@es-master ~]# echo ${data_01[@]}
1.1.1.1 1.1.1.2 1.1.1.3 1.1.1.4
```

```
[root@es-master ~]# for i in ${data_01[*]}
> do
> echo $i
> done
1.1.1.1
1.1.1.2
1.1.1.3
1.1.1.4
```

```
[root@es-master ~]# data_01=(1.1.1.1 1.1.1.2 1.1.1.3 1.1.1.4)
[root@es-master ~]# 
[root@es-master ~]# echo ${data_01[2]}
1.1.1.3
[root@es-master ~]# echo ${data_01[0]}
1.1.1.1
```







