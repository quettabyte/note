## SHELL脚本

### 一、shell脚本

```
本质上就是文本文件
作用: 
	将重复执行的操作写成脚本，自动执行 
```



### 二、重定向符号的使用 

```
类型: 
	输出重定向
	输入重定向 
```

```
[root@web_server ~]# ls -l /dev/std*
lrwxrwxrwx 1 root root 15 Jan 26 09:32 /dev/stderr -> /proc/self/fd/2
lrwxrwxrwx 1 root root 15 Jan 26 09:32 /dev/stdin -> /proc/self/fd/0
lrwxrwxrwx 1 root root 15 Jan 26 09:32 /dev/stdout -> /proc/self/fd/1

/dev/stdin		标准输入设备			键盘、鼠标 
/dev/stdout		标准输出设备			  显示器
/dev/stderr		标准错误输出设备	    显示器
```



#### 1、输出重定向 

```
>
2>
&>
```

##### 1)  >， >>

```
>	覆盖

[root@web_server ~]# echo "abc" > /tmp/file02 
[root@web_server ~]# cat /tmp/file02
abc
[root@web_server ~]# echo "123" > /tmp/file02 
[root@web_server ~]# 
[root@web_server ~]# cat /tmp/file02 
123


>>	追加

[root@web_server ~]# cat /tmp/file02 
123
[root@web_server ~]# echo "abc" >> /tmp/file02 
[root@web_server ~]# cat /tmp/file02
123
abc
[root@web_server ~]# echo "martin" >> /tmp/file02 
[root@web_server ~]# cat /tmp/file02
123
abc
martin

```



```
仅能重定向标准输出 

[root@web_server ~]# ls -ldh /etc/ > /tmp/file01 
[root@web_server ~]# cat /tmp/file01 
drwxr-xr-x. 79 root root 8.0K Jan 26 09:39 /etc/

[root@web_server ~]# echo "abc" > /tmp/file02
[root@web_server ~]# cat /tmp/file02
abc

[root@web_server ~]# > /var/log/messages 
```



##### 2) 2> 

```
仅重定向标准错误错误 

[root@web_server ~]# ls -ldh /dsfjlk 2> /tmp/file01 
```



##### 3) &>

```
重定向所有信息 

[root@web_server ~]# ls -ldh /etc/ &> /tmp/file01 
[root@web_server ~]# ls -ldh /sfjl &> /tmp/file01 

/dev/null 黑洞文件 

[root@web_server ~]# ls -ldh /etc/ > /dev/null
[root@web_server ~]# ls -ldh /etc/ &> /dev/null
```



#### 2、输入重定向符号 

```
<
将一个文件的内容作为参数传递给命令 

[root@web_server ~]# tr 'a-z' 'A-Z' < /tmp/file01  
ABCD
```





### 三、输出语句的使用 

#### 1、echo语句  

```
[root@web_server ~]# echo "hello, shell"
hello, shell

[root@web_server ~]# echo "虚拟机管理脚本"
虚拟机管理脚本

\n: 换行符
\t: tab空白

[root@web_server ~]# echo -e "shell\npython"
shell
python

[root@web_server ~]# echo -e "shell\tpython"
shell	python
```

```
双引号、单引号的区别: 

1、单引号

	所有字符会被作为普通字符输出 

[root@web_server ~]# echo 'shell!!'
shell!!

2、双引号

	特殊含义的字符会被转义 

[root@web_server ~]# echo "shell!!"
```



#### 2、here document 

```
便于输出多行内容  

[root@web_server ~]# cat << eof
> shell
> python
> Golang
> java
> eof

[root@web_server ~]# cat << eof
> ---------管理机管理脚本----------
> 1. 创建虚拟机
> 2. 删除虚拟机
> 3. 修改虚拟机配置
> 4. 退出
> eof
```





### 三、变量的使用

```
作用: 增加脚本功能的灵活性 

类型:

用户自定义的变量
环境变量
特殊变量
```



#### 1、用户自定义的变量 

##### 1) 定义变量

```
语法: 

变量名称=值

变量名称规范: 
	1. 变量名称只能包含字母、数字、下划线 
	2. 变量名称只能以字母、下划线 
	3. 不能与shell中关键字冲突 
	4. 见名知义 


[root@web_server ~]# ip=10.1.1.1
```



##### 2) 调用变量的值  

```
$变量名称 
${变量名称}

注意: 变量事先不存在，获取的为空值，不会报错

所有数据会被shell作为普通字符处理 

[root@web_server ~]# ip=10.1.1.1

[root@web_server ~]# echo "服务器地址: $ip"
服务器地址: 10.1.1.1
[root@web_server ~]# echo "服务器地址: ${ip}"
服务器地址: 10.1.1.1

[root@web_server ~]# data=dog

[root@web_server ~]# echo "It is a $data"
It is a dog
[root@web_server ~]# echo "It is a ${data}"
It is a dog

[root@web_server ~]# echo "There are some ${data}s"
There are some dogs
```



##### 3) 进行数学运算 

```
常用运算符: 
	+, -, *, /, % 取余 
	
[root@web_server ~]# a=10
[root@web_server ~]# b=4

[root@web_server ~]# let c=a%b
[root@web_server ~]# echo $c
2

获取100以内的随机数

[root@web_server ~]# echo $((RANDOM%100))
```



```
方法1: $((数学表达式))

[root@web_server ~]# a=10
[root@web_server ~]# b=20
[root@web_server ~]# c=$((a+b))
[root@web_server ~]# echo $c
30
```



```
方法2: let   关键字

[root@web_server ~]# a=10
[root@web_server ~]# b=20
[root@web_server ~]# let c=a+b
[root@web_server ~]# echo $c
30
```



```
方法3: declare 关键字 

[root@web_server ~]# a=10
[root@web_server ~]# b=20
[root@web_server ~]# declare -i c=a+b
[root@web_server ~]# echo $c
30
```



##### 4) 交互式定义变量 

```
read -p "提示信息" 变量名称  

[root@web_server ~]# read -p "用户名: " name
用户名: martin
[root@web_server ~]# echo $name
martin
[root@web_server ~]# read -p "用户名: " name
用户名: robin
[root@web_server ~]# echo $name
robin
```



##### 5) 定义变量保存命令的结果  

```
[root@web_server ~]# data=$(date +%F)
[root@web_server ~]# echo $data
2021-01-26

[root@web_server ~]# data=$(openssl rand -hex 10)
[root@web_server ~]# echo $data
```

#####  

##### 6）删除变量 

```
# unset 变量名称 

[root@web_server ~]# ip=10.1.1.1
[root@web_server ~]# unset ip
```



#### 2、环境变量

```
定义当前系统的操作环境
安装部署Java应用程序 
```

##### 1) 查看环境变量

```
[root@web_server ~]# env 
```

##### 2) 定义、修改环境变量 

```
# export 环境变量=值 

	注意: 环境变量名称要求大写

永久生效: 
	/etc/profile		//针对所有用户生效
	~/.bash_profile		//仅针对当前用户生效
```

```
示例1: 在历史命令中显示时间 

export HISTTIMEFORMAT="%F_%T  "

[root@web_server ~]# history
    1  2021-01-26_09:33:59  clear
    2  2021-01-26_09:33:59  vi /etc/sysconfig/selinux 
    3  2021-01-26_09:33:59  setenforce 0
```

```
示例2: 修改系统语言 

[root@web_server ~]# echo $LANG
en_US.UTF-8

[root@web_server ~]# export LANG=zh_CN.UTF-8
```

```
示例3: 修改命令提示符样式  

[root@web_server ~]# echo $PS1
[\u@\h \W]\$

#  tail -n 1 /etc/profile
export PS1="[\u@\H \w]\n\\$  "
```



#### 3、特殊变量

```
$?
	代表上一条命令的执行状态  
		0: 执行成功 
		非0: 执行失败 
```



### 四、awk的基本使用 

```
默认按空白字符分割文本，在awk内部有类似于$1, $2, $3这样的变量，$1代表第一部分、$2代表第二部分，依次类推

常用选项: 
	-F	指定分割符  

#  ifconfig ens33 | grep "netmask" | awk '{print $2}'
192.168.183.10

[root@web_server.linux.com ~]
#  ip=$(ifconfig ens33 | grep "netmask" | awk '{print $2}')

[root@web_server.linux.com ~]
#  echo $ip
192.168.183.10

[root@web_server.linux.com ~]
#  head -n 2 /etc/passwd | tail -n 1 | awk -F: '{print $3}'
1

[root@web_server.linux.com ~]
#  head -n 2 /etc/passwd | tail -n 1 | awk -F: '{print $3,$6}'
1 /bin

逐行处理工具 
[root@web_server.linux.com ~]
#  head -n 2 /etc/passwd | awk -F: '{print $3}'
```



### 五、简单脚本案例



#### 1、创建用户的脚本 

```
#!/bin/bash				//指定命令的解释器
#
useradd king
echo "redhat" | passwd --stdin king &> /dev/null
echo "用户king创建完成"
```

```
执行脚本方法1: 

#  bash 脚本文件名称  
#  bash /opt/shell/userCreate.sh 
```

```
执行脚本方法2:

[root@web_server.linux.com ~]
#  chmod a+x /opt/shell/userCreate.sh  
[root@web_server.linux.com ~]
#  /opt/shell/userCreate.sh 
```



#### 2、改写脚本，使用变量 

```
#!/bin/bash
#

username=tome
password=redhat

useradd $username
echo "$password" | passwd --stdin $username &> /dev/null
echo "用户$username创建完成"
```



#### 3、改写脚本

```
#!/bin/bash
#

read -p "用户名: " username
read -p "密码: " password

useradd $username
echo "$password" | passwd --stdin $username &> /dev/null
echo "用户$username创建完成"
```



#### 4、编写配置本地源的脚本 

```
#!/bin/bash
#

# 备份centos自带的yum源 
mkdir /etc/yum.repos.d/bak
mv /etc/yum.repos.d/Ce* /etc/yum.repos.d/bak 

# 配置本地源 
mount /dev/sr0 /mnt &> /dev/null
cat << eof > /etc/yum.repos.d/local.repo
[local]
name=local
baseurl=file:///mnt
enabled=1
gpgcheck=0
eof

yum clean all &> /dev/null
yum repolist
```

























