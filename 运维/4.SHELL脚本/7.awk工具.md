## awk工具

### 一、awk工具介绍

```
作用: 
	按照特定的条件搜索数据，按特定的格式进行显示 
	
工作流程:
	默认按照空白字符分割文本，将文本分成多部分； 在awk内部有类似于$1变量用于代表第一部分内容, $2代表第二部分，依次类推； $0代表整行文本 
	逐行处理工具
	
-F选项: 指定分割符  
```

#### 1、awk使用格式

```
# awk [options] 'script' 文件名称 文件名称 文件名称 
```

```
# awk [options] 'pattern{action}' 文件名称 文件名称

	pattern: 特定的条件 
	action: 操作
		print
		printf
```



### 二、action 操作

#### 1、print 显示操作

```
[root@es-master ~]# sed -n '1p' /etc/passwd | awk -F: '{print $3}'
```

```
[root@es-master ~]# sed -n '1p' /etc/passwd | awk -F: '{print $3,$6}'
```

```
[root@es-master ~]# sed -n '1p' /etc/passwd | awk -F: '{print $0}'
```

```
[root@es-master ~]# sed -n '1,2p' /etc/passwd | awk -F: '{print $6}'
```

```
[root@es-master ~]# sed -n '1,2p' /etc/passwd | awk -F: '{print "用户名:", $1}'
```

```
[root@es-master ~]# df -hT | grep "^/" | awk '{print "磁盘名称:", $1, "使用率:", $6, "挂载点:", $7}'
```

```
[root@es-master ~]# rpm -qa | grep http | awk -F-2 '{print "rpm -e", $1}' | bash 
```

```
[root@es-master ~]# ps -elf | grep vim | sed '$d' | awk '{print "kill", $4}' | bash
```



#### 2、printf 	格式化输出

```
使用格式:

printf "格式"，内容1, 内容2, 内容3
```

```
格式的写法: 

1、占位符 
	%s		字符串
		%8s		设置显示数据的字符宽度
		%-8s	左对齐显示，默认是右对齐
	%d		整数
	%f		浮点数，小数
```

```
注意:
	printf默认没有换行，需要手动添加换行符 \n
```

```
[root@es-master ~]# echo "hello" | awk '{printf "%s", $0}'
[root@es-master ~]# echo "hello" | awk '{printf "%9s", $0}'
[root@es-master ~]# echo "hello" | awk '{printf "%-9s", $0}'
```

```
[root@es-master ~]# echo "shell python golang" | awk '{printf "%s%s", $1, $3}'
[root@es-master ~]# echo "shell python golang" | awk '{printf "%8s%10s", $1, $3}'
[root@es-master ~]# echo "shell python golang" | awk '{printf "%-8s%-10s", $1, $3}'
[root@es-master ~]# echo "shell python golang" | awk '{printf "%-8s%-10s\n", $1, $3}'
```

```
[root@es-master ~]# sed -n '1,3p' /etc/passwd | awk -F: '{printf "%-8s%-6s\n", $1, $6}'
```

```
[root@es-master ~]# df -hT | grep "^/" | awk '{printf "%-8s%-24s%-6s%-6s%-6s%-10s\n",  "磁盘名称:", $1, "使用率:", $6, "挂载点:", $7}'
磁盘名称:   /dev/mapper/centos-root 使用率:  26%   挂载点:  /         
磁盘名称:   /dev/sda1               使用率:  24%   挂载点:  /boot   
```



### 三、awk变量的使用

```
类型:
	自定义变量
	内置变量
```

#### 1、自定义变量

```
方法1：

-v 变量名称=值 

调用变量:
	变量名称 
	
[root@es-master ~]# awk -v name="martin" 'BEGIN{print "hello", name}'

[root@es-master ~]# awk -v name="martin" -v age=30 'BEGIN{print "hello", name, "My Age is", age}'
```



```
方法2: 

在BEGIN{}模式中定义 

[root@es-master ~]# awk 'BEGIN{name="martin"; print "hello", name}'
```



#### 2、内置变量

##### 1) FS,  OFS

```
FS变量:
	作用与-F选项一样
	awk读取文本时指定行分割符，默认是空白
	
[root@es-master ~]# sed -n '1p' /etc/passwd | awk -v FS=":" '{print $1, $3}'
```

```
OFS变量
	指定awk在输出多段内容时的分隔符，默认是空白
	
[root@es-master ~]# sed -n '1p' /etc/passwd | awk -v OFS="---->" -F: '{print $1, $3}'
root---->0
```



##### 2) NR, FNR

```
记录awk读取文本时的行号

区别:
	NR变量, awk在处理多个文件时，所有文件的行号是统一记录的
	FNR变量, awk在处理多个文件时，所有文件的行号是单独记录的

[root@es-master ~]# awk '{print NR}' /etc/hosts
1
2
[root@es-master ~]# awk '{print FNR}' /etc/hosts
1
2
[root@es-master ~]# awk '{print NR}' /etc/hosts /etc/redhat-release 
1
2
3
[root@es-master ~]# awk '{print FNR}' /etc/hosts /etc/redhat-release 
1
2
1
```

```
[root@es-master ~]# awk '/^\//{print NR, $0}' /etc/fstab
```

```
[root@es-master ~]# awk 'NR==3{print $0}' /etc/passwd
```



##### 3) NF

```
记录awk分割文本时，被分割的段数 

[root@es-master ~]# sed -n '1p' /etc/passwd | awk -F: '{print NF}'

[root@es-master ~]# cat /tmp/file01 
linux windows unix
shell python go

[root@es-master ~]# awk '{print NF}' /tmp/file01
3
3
```

```
[root@es-master ~]# df -hT | grep "^/" | awk '{print $NF}'
```

```
[root@es-master ~]# cat /tmp/file01
linux windows unix
shell python 
MySQL Oracle PostgreSQL SQLServer

[root@es-master ~]# awk '{print $NF}' /tmp/file01
unix
python
SQLServer
```



### 四、pattern的写法

#### 1、表达式

##### 1) 数字表达式

```
+, -, *, /, %
++, --
```

##### 2）字符表达式

```
+	拼接

“ab" + "cd" = abcd
```

##### 3) 比较表达式

```
==,  !=, >, >=, <, <=

字符串 ~ 正则表达式
```

##### 4) 逻辑表达式

```
&&	并且 
||	或者
```

```
[root@es-master ~]# awk -F: '$3<=10{print $1}' /etc/passwd
```

```
[root@es-master ~]# awk -F: '$3>=1 && $3<=999{print $1}' /etc/passwd
```

```
[root@es-master ~]# df -hT | grep "^/" | awk '+$6>25{print $1, $NF}'  
```

```
[root@es-master ~]# awk -F: '$7=="/sbin/nologin"{print $1}' /etc/passwd
[root@es-master ~]# awk -F: '$7 ~ "nologin$"{print $1}' /etc/passwd
```



#### 2、/正则表达式/

```
[root@es-master ~]# netstat -antp | awk '/^tcp/{print $0}'
```

```
[root@es-master ~]# awk -F: '/^(r|s)/{print $1}' /etc/passwd
```



#### 3、/正则表达式1/， /正则表达式2/

```
[root@es-master ~]# awk '/Feb 22 13:39:23/,/Feb 22 13:39:50/{print $0}' /var/log/messages
```



#### 4、BEGIN{}	处理文件前执行的操作 

```
[root@es-master ~]# sed -n '1,3p' /etc/passwd | awk -F: 'BEGIN{print "----用户列表-----"}{print $1, $3}'
```



#### 5、END{}	文件所有数据处理完毕后执行的操作 

```
[root@es-master ~]# sed -n '1,3p' /etc/passwd | awk -F: 'BEGIN{print "----用户列表-----"}{print $1, $3}END{print "------结束--------"}'
```





### 五、action操作----逻辑控制语句 

#### 1、条件判断 

```
语法: 

if(条件) {条件为真执行的操作}
if(条件) {条件为真执行的操作} else {条件为假执行的操作}
if(条件) {条件为真执行的操作} else if(条件) {条件为真执行的操作}
```

```
[root@es-master ~]# awk -F: '{if($3==0) {print $1, "是管理员"} else {print $1, "是普通用户"}}' /etc/passwd
```

```
[root@es-master ~]# awk -F: -v bash_number=0 -v nologin_number=0 '{if($7=="/bin/bash") {bash_number++} else if($7=="/sbin/nologin") {nologin_number++}}END{print "bash用户数量:", bash_number, "nologin用户数:", nologin_number}' /etc/passwd 
```

```
[root@es-master ~]# df -hT | awk '/^\//{if(+$6>20) {print "磁盘名称:", $1, "使用率:", $6, "挂载点:", $7}}'
```



#### 2、for循环

```
语法: 

for(变量的定义;循环条件;改变循环条件真假的语句) {执行的操作}

	break, continue

```

```
[root@es-master ~]# sed -n '1,3p' /etc/passwd | awk -F: '{for(i=1;i<=7;i++) {if(length($i)>4) {print $i}}}'
```

```
[root@es-master ~]# awk '{for(i=1;i<=NF;i++) {if(length($i)>6) {print $i}}}' /tmp/file01
```

























