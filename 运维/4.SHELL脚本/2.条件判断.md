## 条件判断

### 一、条件判断 

```
支持的语法结构: 
	if 
	case
```



### 二、if条件判断 

```
语法: 

if 条件; then
     执行的操作
     执行的操作
fi
```

```
条件的写法: 
1、shell命令，判断命令的执行状态码 
2、[ 表达式 ]
```

```
常用表达式: 
1、数字表达式
	[ number1 -eq number2 ]		等于
	[ number1 -ne number2 ]		不等于
	[ number1 -gt number2 ]		大于
	[ number1 -ge number2 ]		大于等于
	[ number1 -lt number2 ]		小于
	[ number1 -le number2 ]		小于等于

2、字符串表达式
3、文件目录表达式
```



#### 案例1： 创建用户，判断用户是否存在，不存在则创建用户 

```
#!/bin/bash
#

read -p "用户名: " username

#判断用户不存在，则创建用户 
id $username &> /dev/null
if [ $? -ne 0 ]; then
    useradd $username
    echo "redhat" | passwd --stdin $username &> /dev/null
    echo "用户$username创建完成，初始密码为redhat"
fi
```

```
#!/bin/bash
#

read -p "用户名: " username

#判断用户不存在，则创建用户 
if ! id $username &> /dev/null; then					// ! 表示对条件的结果进行取反 
    useradd $username
    echo "redhat" | passwd --stdin $username &> /dev/null
    echo "用户$username创建完成，初始密码为redhat"
fi
```



### 三、if条件判断 --- 单分支if

```
语法: 

if 条件; then
    执行的操作
    执行的操作
else
	执行的操作
	执行的操作
fi
```



#### 案例1: 改写创建用户脚本 

```
#!/bin/bash
#

read -p "用户名: " username

#判断用户不存在，则创建用户 
if ! id $username &> /dev/null; then
    useradd $username
    echo "redhat" | passwd --stdin $username &> /dev/null
    echo "用户$username创建完成，初始密码为redhat"
else
    echo "用户$username已存在"
fi
```



#### 案例2: 判断用户uid, gid，如果相同，显示Good user, 否则显示Bad user 

```
#!/bin/bash
#

read -p "用户名: " username 

user_id=$(id -u $username)
group_id=$(id -g $username)

if [ $user_id -eq $group_id ]; then
   echo "Good user."
else
   echo "Bad user."
fi
```



#### 案例3: 判断文件中是否存在空行，有则显示空行的行数，否则显示没有空行

```
#!/bin/bash
#

read -p "文件名称: " file_name

if grep "^$" $file_name &> /dev/null; then
     line_number=$(grep "^$" $file_name | wc -l)
     echo "文件$file_name空行数量: $line_number"
else
     echo "文件$file_name没有空行"
fi
```



#### 案例4: 检测磁盘的使用率

```
#!/bin/bash
#

echo "现有文件系统如下: "
df -hT | grep "^/" | awk '{print $7}'
echo

read -p "磁盘名称: " disk_name
usage=$(df -hT $disk_name | sed '1d' | awk '{print $6}' | awk -F% '{print $1}')

if [ $usage -gt 60 ]; then
     echo "警告"
else
     echo "正常"
fi
```



### 四、if条件判断 ---- 多if分支 

```
适用于判断变量有多种不同的取值 

语法: 

if 条件1; then
     执行的操作
     执行的操作
elif 条件2; then
	 执行的操作
	 执行的操作
elif 条件3; then
	 执行的操作
	 执行的操作
elif 条件4; then
	 执行的操作
	 执行的操作
else
	执行的操作
	执行的操作
fi
```

```
多条件的写法: 
	and, or

1、and 并且

	[ 条件1 -a 条件2 ]
	[ 条件1 ] && [ 条件2 ]
	
2、or 或者 

	[ 条件1 -o 条件2 ]
	[ 条件1 ] || [ 条件2 ]

```



#### 案例1: 判断成绩  

```
#!/bin/bash
#

read -p "成绩: " score 

if [ $score -ge 90 -a $score -lt 100 ]; then
    echo "优"
elif [ $score -ge 80 -a $score -lt 90 ]; then
    echo "良"
elif [ $score -ge 70 -a $score -lt 80 ]; then
    echo "中"
elif [ $score -ge 60 -a $score -lt 70 ]; then
    echo "差"
else
    echo "不及格"
fi
```



### 五、if条件判断 ---- 嵌套if 

```
语法： 

if 条件; then
    if 条件; then
         执行的操作
         执行的操作
    else
         执行的操作
         执行的操作
    fi
else
    执行的操作
    执行的操作
fi
```

```
#!/bin/bash
#

read -p "用户名: " username

# 判断用户是否存在
if id $username &> /dev/null; then
   # 获取用户uid, gid进行判断
   user_id=$(id -u $username)
   group_id=$(id -g $username)
   if [ $user_id -eq $group_id ]; then
       echo "Good user."
   else
       echo "Bad user."
   fi
else
  echo "用户$username不存在"
fi
```



### 六、字符串表达式

```
[ 字符串1 == 字符串2 ]
[ 字符串1 != 字符串2 ]
[ -z 字符串 ]		// 判断字符串是否为空
```

```
#!/bin/bash
#

read -p "输入密码: " pwd_01
read -p "确认密码: " pwd_02

if [ "$pwd_01" == "$pwd_02" ]; then
   echo "密码设置成功"
else
   echo "密码不一致"
fi
```



### 七、文件目录表达式

```
[ -e 文件或目录名称 ]				判断文件目录是否存在
[ -f 文件名称 ]					  判断是否为普通文件
[ -d 文件名称 ]					  判断是否为目录
[ -r 文件名称 ]
[ -w 文件名称 ]
[ -x 文件名称 ]
```

```
注意: 
	所有单目表达式都可以在条件的前面加一个!表示取反 
	
	[ ! -e 文件或目录名称 ]
```



#### 案例: 拷贝文件

```
#!/bin/bash
#

read -p "文件名称: " file_name

# 判断文件是否存在
if [ -e $file_name ]; then
   read -p "目录名称: " dir_name
   # 判断目录是否存在
   if [ -e $dir_name ]; then
       cp $file_name $dir_name
       echo "文件$file_name已拷贝到目录$dir_name"
   else
       mkdir -p $dir_name 
       cp $file_name $dir_name
       echo "文件$file_name已拷贝到目录$dir_name"
   fi
else
  echo "文件$file_name不存在"
fi
```











