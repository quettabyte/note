# 信令系统

**Public Switched Telephone Network(PSTN)**

PSTN：公共交换电话网络，一种常用旧式电话系统。即我们日常生活中常用的电话网。 众所周知，PSTN是一种以模拟技术为基础的电路交换网络。在众多的广域网互连技术中，通过PSTN进行互连所要求的通信费用最低，但其数据传输质量及传输速度也最差，同时PSTN的网络资源利用率也比较低。

**Signaling Transport(SIGTRAN)**

SIGTRAN协议是IETF的信令传送工作组建立的一套在IP网络上传送PSTN信令的传输控制协议。SIGTRAN定义了一个比较完善的SIGTRAN协议堆栈，分为IP协议层、信令传输层、信令传输适配层和信令应用层。每层所含内容如下：

*   IP协议层：IP
*   信令传输层：SCTP
*   信令传输适配层：SUA、M3UA、M2UA、M2PA、IUA
*   信令应用层：TCAP、TUP、ISUP、SCCP、MTP3、Q931/QSIG

不同的信令应用层需要不同的信令传输适配层，但IP协议层和信令传输层是共享的和相同的。信令传输适配层与信令应用层的对应关系如下：

*   SUA对应TCAP
*   M3UA对应TUP、ISUP、SCCP、TCAP
*   M2UA/M2PA对应MTP3、ISUP
*   IUA对应Q931/QSIG、ISUP

<img src="https://cokeice-pic.oss-cn-wulanchabu.aliyuncs.com/1693813262771.png" />

**Signaling System 7(SS7)**

7号信令（Common Channel Signaling System No. 7）是由ITU-T（International Telecommunication Union-Telecommunication Standardization Sector）制定的全球电信业的标准。这个标准指定了在PSTN中各个网络点通过数字信令网交换信息的过程及协议。使用这些协议，使的有线及无线呼叫的建立、路由及控制更为有效。

<img src="https://cokeice-pic.oss-cn-wulanchabu.aliyuncs.com/1693460183225.png" />

# SCTP

`RFC2960`

SCTP（Stream Control Transmission Protocol），流控制传输协议是一个 IP 协议之上的、可靠的、面向控制信令的传输层协议。SCTP 可以在 “尽力而为（无连接、不可靠）” 的 IP 网络之上为电信级信令传输提供高效、可靠的信令传输服务，例如 5GC 中的 N4 接口就使用了 SCTP 协议。

SCTP 的诞生是为了弥补 TCP/UDP 在电信网络控制信令传输场景中的不足，它们都难以完全满足在电信网络中信令承载的要求。包括：

*   UDP 是一种无连接的不可靠传输协议，自然无法满足信令对传输质量的要求。
*   TCP 虽然是一种基于连接的可靠传输协议，但同时也具有队头阻塞、实时性差、支持多归属困难、易受 DDOS（拒绝服务）攻击的缺陷。

为了解决 TCP/UDP 协议在传输实时信令时所面临的不可靠传输和时延等问题，SCTP 协议设计了以下的核心特性，包括：

*   适当的拥塞控制；
*   防止泛滥和伪装攻击；
*   更优的实时性能；
*   多属主（Multi-homing）特性支持；
*   多流（Multi-streaming）特性支持；
*   等等。

用于呼叫信令的传输协议，创建它是为了克服TCP在用于电话节点之间的信令时的一些不足和问题

## 协议号

*   IP：SCTP通常使用IP作为其底层协议。IP上的SCTP分配的Protocol Number为**132**。

## 消息格式

一个 SCTP 报文包含了一个 Common Header（公共报头）和若干个 Chunk（数据块），每 个数据块中既可以包含控制信息，也可以包含用户数据

**Common Header**

<img src="https://cokeice-pic.oss-cn-wulanchabu.aliyuncs.com/1693470378898.png" />

*   Source Port Number（源端口号）
*   Destination Port Number（目的端口号）
*   Verification Tag（验证标签）
*   Checksum（校验码）

**Chunk**

<img src="https://cokeice-pic.oss-cn-wulanchabu.aliyuncs.com/image-20230831163013542.png" />

*   Chunk Type

        The values of Chunk Types are defined as follows:
        
        ID Value    Chunk Type
        -----       ----------
        0          - Payload Data (DATA)
        1          - Initiation (INIT)
        2          - Initiation Acknowledgement (INIT ACK)
        3          - Selective Acknowledgement (SACK)
        4          - Heartbeat Request (HEARTBEAT)
        5          - Heartbeat Acknowledgement (HEARTBEAT ACK)
        6          - Abort (ABORT)
        7          - Shutdown (SHUTDOWN)
        8          - Shutdown Acknowledgement (SHUTDOWN ACK)
        9          - Operation Error (ERROR)
        10         - State Cookie (COOKIE ECHO)
        11         - Cookie Acknowledgement (COOKIE ACK)
        12         - Reserved for Explicit Congestion Notification Echo (ECNE)
        13         - Reserved for Congestion Window Reduced (CWR)
        14         - Shutdown Complete (SHUTDOWN COMPLETE)
        15 to 62   - reserved by IETF
        63         - IETF-defined Chunk Extensions
        64 to 126  - reserved by IETF
        127        - IETF-defined Chunk Extensions
        128 to 190 - reserved by IETF
        191        - IETF-defined Chunk Extensions
        192 to 254 - reserved by IETF
        255        - IETF-defined Chunk Extensions

    另外，Chunk type 的高两位 bit 指示了接收端不认识对应的 Chunk type 的处理原则：

    *   00：停止处理数据报并丢弃，不再处理报中的其他 Chunk。
    *   01：与 00 相同处理外，还要在 ERROR 或 INIT ACK 中上报，原因为不认识的参数类型。
    *   10：忽略该 Chunk，继续处理数据报中的其他 Chunk。
    *   11：同 10 相同处理外，还要在 ERROR 中上报，原因为不认识的 Chunk 类型。

*   Chunk Flags

*   Chunk Length

*   Chunk Vaule

    Chunk Value字段包含要在Chunk中传输的实际信息。该字段的用法和格式取决于Chunk Type。

    eg：*Payload Data (DATA) (0)*

    <img src="https://cokeice-pic.oss-cn-wulanchabu.aliyuncs.com/1693471421068.png" />

    *   **Reserved**：预留，应当设置为全 0，在接收方忽略。

    *   **U（比特）**：非顺序比特。如果该比特设置为 1，则指示这是一个非顺序的数据块，不需要给该数据块分配流顺序号码，所有接收方必须忽略流顺序号码。在重新组装完成后（如果需要），非顺序的数据块不需要尝试任何重新排序的过程，可以由接收方直接递交到高层；如果一个非顺序的用户消息被分段，则消息的每个分段中的 U 比特必须被设置为 1。

    *   **B（比特）**：分段开始比特。如果该比特被设置，则表示这是用户消息的第一个分段。

    *   **E（比特）**：分段结束比特。如果该比特被设置，则指示这是用户消息的最后一个分段。一个未分段的用户消息应当把所有的 B 和 E 比特设置为 1。如果 B 和 E 比特都设置为 0，则表明这是一个分段的用户消息的一个中间分段。当用户消息被分段到多个数据块中，接收方需要使用 TSN 对消息进行重组，这意味着给分段的用户消息的每个分段都必须要使用连续的 TSN。

        > B、E 比特的取值含义如下：
        >
        > B=1、E=0：用户消息的第 1 个分片。
        >
        > B=0、E=0：用户消息的中间分片。
        >
        > B=0、E=1：用户消息的最后一个分片。
        >
        > B=1、E=1：未分片的消息。

    *   **Length**：表示数据块从类型字段开始到用户数据字段结束之间的字节数，但不包含任何填充字节，如果数据块的用户数据字段为 0，则长度字段设为 16。

    *   **TSN**：TSN 的值达到 4294967295 后将回转到 0。

    *   **Stream Identifier S**：表示用户数据属于的流。

    *   **Stream Sequence Number n**：表示所在流中的用户数据的顺序号码。有效值为 0\~65535。当一个用户消息被 SCTP 分段后，则必须在消息的每个分段中都带有相同的流顺序号码。

    *   **Payload Protocol Identifier（PPID）**：表示一个应用（或上层协议）特定的协议标识符。这个值由高层协议传递到 SCTP，并发送到对端。这个标识符不由 SCTP 使用，但却可以由特定的网络实体或对等的应用来识别在数据块中携带的信息类型。甚至在每个分段的数据块中也应包含该字段（以确保对网络中间的代理可用）。

    *
        *   0 表示高层未对该协议净荷规定应用标识符。
        *   M2UA 协议净荷使用编码 2。
        *   M3UA 协议净荷使用编码 3。
        *   SUA 协议净荷使用编码 4。
        *   M2PA 协议净荷使用的编码待定。

    *   **User Data**：用来携带用户数据净荷。该字段必须被填充为 4 字节的整数，发送方填充的字节数应不超过 3 个字节，接收方忽略所有的填充字节。

## Example

    Frame 3 (70 bytes on wire, 70 bytes captured)
        Arrival Time: Jul  1, 2004 17:44:49.872282000
        Time delta from previous packet: 0.087355000 seconds
        Time since reference or first frame: 0.087704000 seconds
        Frame Number: 3
        Packet Length: 70 bytes
        Capture Length: 70 bytes
    Ethernet II, Src: 00:01:af:0c:06:96, Dst: 00:a0:80:00:5e:46
        Destination: 00:a0:80:00:5e:46 (00:a0:80:00:5e:46)
        Source: 00:01:af:0c:06:96 (00:01:af:0c:06:96)
        Type: IP (0x0800)
    Internet Protocol, Src Addr: 10.28.6.42 (10.28.6.42), Dst Addr: 10.28.6.44 (10.28.6.44)
        Version: 4
        Header length: 20 bytes
        Type of service: 0x00 (None)
            000. .... = Precedence: routine (0)
            ...0 .... = Delay: Normal
            .... 0... = Throughput: Normal
            .... .0.. = Reliability: Normal
            .... ..0. = Cost: Normal
        Total Length: 56
        Identification: 0xca40 (51776)
        Flags: 0x00
            0... = Reserved bit: Not set
            .0.. = Don't fragment: Not set
            ..0. = More fragments: Not set
        Fragment offset: 0
        Time to live: 64
        Protocol: SCTP (0x84)
        Header checksum: 0x8f74 (correct)
        Source: 10.28.6.42 (10.28.6.42)
        Destination: 10.28.6.44 (10.28.6.44)
    Stream Control Transmission Protocol
        Source port: 2905
        Destination port: 2905
        Verification tag: 0x00000e50
        Checksum: 0x53c3055f (correct Adler32)
        HEARTBEAT chunk (Information: 20 bytes)
            Chunk type: HEARTBEAT (4)
                0... .... = Bit: Stop processing of the packet
                .0.. .... = Bit: Do not report
            Chunk flags: 0x00
            Chunk length: 24
            Heartbeat info parameter (Information: 16 bytes)
                Parameter type: Heartbeat info (0x0001)
                    0... .... .... .... = Bit: Stop processing of chunk
                    .0.. .... .... .... = Bit: Do not report
                Parameter length: 20
                Heartbeat information: 40E44B920A1C062C1B66AF7E00000000
    
    Frame 4 (70 bytes on wire, 70 bytes captured)
        Arrival Time: Jul  1, 2004 17:44:49.872631000
        Time delta from previous packet: 0.000349000 seconds
        Time since reference or first frame: 0.088053000 seconds
        Frame Number: 4
        Packet Length: 70 bytes
        Capture Length: 70 bytes
    Ethernet II, Src: 00:a0:80:00:5e:46, Dst: 00:01:af:0c:06:96
        Destination: 00:01:af:0c:06:96 (00:01:af:0c:06:96)
        Source: 00:a0:80:00:5e:46 (00:a0:80:00:5e:46)
        Type: IP (0x0800)
    Internet Protocol, Src Addr: 10.28.6.44 (10.28.6.44), Dst Addr: 10.28.6.42 (10.28.6.42)
        Version: 4
        Header length: 20 bytes
        Type of service: 0x00 (None)
            000. .... = Precedence: routine (0)
            ...0 .... = Delay: Normal
            .... 0... = Throughput: Normal
            .... .0.. = Reliability: Normal
            .... ..0. = Cost: Normal
        Total Length: 56
        Identification: 0xbb81 (48001)
        Flags: 0x04 (Don't Fragment)
            0... = Reserved bit: Not set
            .1.. = Don't fragment: Set
            ..0. = More fragments: Not set
        Fragment offset: 0
        Time to live: 255
        Protocol: SCTP (0x84)
        Header checksum: 0x9f32 (correct)
        Source: 10.28.6.44 (10.28.6.44)
        Destination: 10.28.6.42 (10.28.6.42)
    Stream Control Transmission Protocol
        Source port: 2905
        Destination port: 2905
        Verification tag: 0x0d53e6fe
        Checksum: 0x8c8e0746 (correct Adler32)
        HEARTBEAT_ACK chunk (Information: 20 bytes)
            Chunk type: HEARTBEAT_ACK (5)
                0... .... = Bit: Stop processing of the packet
                .0.. .... = Bit: Do not report
            Chunk flags: 0x00
            Chunk length: 24
            Heartbeat info parameter (Information: 16 bytes)
                Parameter type: Heartbeat info (0x0001)
                    0... .... .... .... = Bit: Stop processing of chunk
                    .0.. .... .... .... = Bit: Do not report
                Parameter length: 20
                Heartbeat information: 40E44B920A1C062C1B66AF7E00000000

# M2UA

`RFC3331`[消息传递部分(MTP)第二级用户适配层(M2UA)技术规范 - 百度文库](https://wenku.baidu.com/view/0a9b04aef524ccbff121848e.html?_wkts_=1693557165760\&bdQuery=M2UA报文格式)

M2UA（MTP2-User Adaptation Layer）即消息传递部分（MTP）第二级用户适配层。该协议用于支持IP网络中的MTP3与电路域七号信令网中的信令点通信，支持 MTP2/MTP3接口边界，支持向管理报告状态改变等功能，传送MTP3与MTP2之间的原语。

## 协议号

*   SCTP：M2UA通常使用SCTP作为其传输协议。Chunk Type = **0**，PPID = **3**。

## 消息格式

M2UA消息中的所有字段必须按网络字节顺序传输，除非另有说明。

**Common Message Header**

<img src="https://cokeice-pic.oss-cn-wulanchabu.aliyuncs.com/1693561901672.png" />

*   version

        The supported versions are the following:
         	1 		Release 1.0

*   Message Class

        The following List contains the valid Message Classes:
        
             0      Management (MGMT) Message [IUA/M2UA/M3UA/SUA]
             1      Transfer Messages [M3UA]
             2      SS7 Signalling Network Management (SSNM) Messages [M3UA/SUA]
             3      ASP State Maintenance (ASPSM) Messages [IUA/M2UA/M3UA/SUA]
             4      ASP Traffic Maintenance (ASPTM) Messages [IUA/M2UA/M3UA/SUA]
             5      Q.921/Q.931 Boundary Primitives Transport (QPTM)
                    Messages [IUA]
             6      MTP2 User Adaptation (MAUP) Messages [M2UA]
             7      Connectionless Messages [SUA]
             8      Connection-Oriented Messages [SUA]
             9      Routing Key Management (RKM) Messages (M3UA)
            10      Interface Identifier Management (IIM) Messages (M2UA)
         11 to 127  Reserved by the IETF
        128 to 255  Reserved for IETF-Defined Message Class extensions

*   Message Type

    不同的Message Class定义不同的Message Type

    > RFC 3331—\[Page 17]

        eg:
        MTP2 User Adaptation (MAUP) Messages
        
            0      	Reserved
            1      	Data
            2      	Establish Request
            3      	Establish Confirm
            4      	Release Request
            5      	Release Confirm
            6      	Release Indication
            7      	State Request
            8      	State Confirm
            9      	State Indication
            10      Data Retrieval Request
            11      Data Retrieval Confirm
            12      Data Retrieval Indication
            13      Data Retrieval Complete Indication
            14      Congestion Indication
            15      Data Acknowledge
        16 to 127   Reserved by the IETF
        128 to 255  Reserved for IETF-Defined MAUP extensions

*   Message Length

    消息长度以字节为单位，包括公共报头和参数填充字节。

**M2UA Message Header**

除了通用消息头之外，还有一个M2UA特定的消息头。特定M2UA的消息头将紧随在公共消息头之后，但仅用于MAUP消息。

这个消息头将包含接口标识符。接口标识符参数的格式可以是文本或整数。国内用的是整数编码

1.  整数型长度固定8字节

    <img src="https://cokeice-pic.oss-cn-wulanchabu.aliyuncs.com/1693562863152.png" />

2.  文本型长度为变长

    标识符的编码为`ANSI X3.4-1986[7]`。基于文本的接口标识符的最大字符串长度为255个字节。标签长度等于接口标识符名称的字符串长度加上Tag和length字段的四个字节。

    <img src="https://cokeice-pic.oss-cn-wulanchabu.aliyuncs.com/1693562960440.png" />

当

**MAUP（Class）——Data（Type）**

当Message Type为Data时，包含以下参数：

    Protocol Data 		(mandatory)强制
    Correlation Id 		(optional)可选

<img src="https://cokeice-pic.oss-cn-wulanchabu.aliyuncs.com/1693563291858.png" />

# MTP3

MTP3是SS7协议栈的一部分。它不是SIGTRAN协议族的一部分。SIGTRAN系列协议的目的是在IP网络上承载SS7通信。MTP Level 3相当于OSI网络层。它在SS7网络中的信令点之间提供消息路由。MTP Level 3将流量从故障链路上重新路由(通常不会丢失任何消息，并且总是不会重新排序消息)，并在发生拥塞或信令点故障时控制流量。

在IP网络中，MTP3通常在M2PA或M2UA上进行(两者在逻辑上都取代MTP2及以下)。M3UA用于跨IP网络传输MTP3有效载荷(它在逻辑上取代了SIGTRAN网络中的MTP3)。

## 协议号

在IP网络中：

*   M2UA，通常承载在M2UA协议之上，M2UA的Message Type为Data（**1**）。
*   M2PA

## 消息格式

*   Service information octet

    服务信息字节

    <img src="https://cokeice-pic.oss-cn-wulanchabu.aliyuncs.com/1693792500980.png" />

    *   Service indicator

        国际信令网业务指示码分配如下:

        bits 	D C B A
        0 0 0 0 Signalling network management messages
        0 0 0 1 Signalling network testing and maintenance messages
        0 0 1 0 Spare
        0 0 1 1 SCCP
        0 1 0 0 Telephone User Part
        0 1 0 1 ISDN User Part
        0 1 1 0 Data User Part (call and circuit-related messages)
        0 1 1 1 Data User Part (facility registration and cancellation messages)
        1 0 0 0 Reserved for MTP Testing User Part
        1 0 0 1 Broadband ISDN User Part
        1 0 1 0 Satellite ISDN User Part
        1011 	)
        1100 	)
        1 1 0 1 ) Spare
        1110 	)
        1111 	)

    *   Sub-service field

    该字段包含网络指示器(比特C和D)和两个备用比特(比特A和B)。网络指示器用于信令消息处理功能(例如，为了确定用户部件的相关版本)，参见2.3和2.4。如果网络指示器设置为00或01，则两个备用比特(编码为00)可用，以备将来可能需要为所有国际用户部件提供通用解决方案时使用。当网络指示灯设置为10或11时，表示这两个空闲位为全国使用。例如，它们可用于指示消息优先级，这在国家应用程序的可选流控制过程中使用。网络指标区分了国际和国内电文。例如，它也可以用于区分两个国家信号网络，每个网络都有不同的路由标签结构，并包括多达16个用户部件，由16个可能的业务指标代码定义。在只有一个国家信令网络的情况下，可以使用为全国使用保留的网络指示器的备用代码，例如，为该国家信令网络定义额外的16个用户部件(使总数为32个用户部件)。

        网络指标码分配如下:
        
        bits 	D C
        		0 0 International network
        		0 1 Spare (for international use only)
        		1 0 National network
        		1 1 Reserved for national use

*   Lable

    标签，包含在信令信息字段中，特别是路由标签。

    <img src="https://cokeice-pic.oss-cn-wulanchabu.aliyuncs.com/1693792344833.png" />

## Example

    Frame 1: 148 bytes on wire (1184 bits), 148 bytes captured (1184 bits)
    Message Transfer Part Level 2
        .100 0010 = Backward sequence number: 66
        1... .... = Backward indicator bit: 1
        .110 1110 = Forward sequence number: 110
        1... .... = Forward indicator bit: 1
        ..11 1111 = Length Indicator: 63
        00.. .... = Spare: 0
    Message Transfer Part Level 3
        Service information octet
            10.. .... = Network indicator: National network (0x2)
            ..00 .... = Spare: 0x0
            .... 0011 = Service indicator: SCCP (0x3)
        Routing label
            .... .... .... .... ..10 0100 1110 0100 = DPC: 9444
            .... 1001 0001 0000 11.. .... .... .... = OPC: 9283
            0011 .... .... .... .... .... .... .... = Signalling Link Selector: 3
    Signalling Connection Control Part
    ANSI Transaction Capabilities Application Part
    ANSI Mobile Application Part

# M3UA

`RFC3332`

M3UA（MTP3 User Adaptation）表示MTP（Message Transfer Part，消息传递部分）第三级用户的适配层协议。M3UA协议是MTP第三级的适配层协议，七号信令网通过M3UA和MTP3的无缝配合，平滑地从SCN网延伸到IP网络中。

<img src="https://cokeice-pic.oss-cn-wulanchabu.aliyuncs.com/1693472054780.png" />

## 协议号

*   SCTP：M3UA通常使用SCTP作为其传输协议。Chunk Type = **0**，PPID = **3**。

## 消息格式

M3UA消息中的所有字段必须按网络字节顺序传输，除非另有说明。

<img src="https://cokeice-pic.oss-cn-wulanchabu.aliyuncs.com/image-20230830143931311.png" />

*   Version

        The supported versions are the following:
         	1 		Release 1.0

*   Message Class

        The following list contains the valid Message Type Classes:
        
             0 		Management (MGMT) Messages
             1 		Transfer Messages
             2 		SS7 Signalling Network Management (SSNM) Messages
             3 		ASP State Maintenance (ASPSM) Messages
             4 		ASP Traffic Maintenance (ASPTM) Messages
             5 		Reserved for Other Sigtran Adaptation Layers
             6 		Reserved for Other Sigtran Adaptation Layers
             7 		Reserved for Other Sigtran Adaptation Layers
             8 		Reserved for Other Sigtran Adaptation Layers
             9 		Routing Key Management (RKM) Messages
        10 to 127 	Reserved by the IETF
        128 to 255 	Reserved for IETF-Defined Message Class extensions

*   Message Type

    不同的Message Class定义不同的Message Type

    > RFC 3332—\[Page 27]

        eg:
        Transfer Messages (See Section 3.3)
         	0 		Reserved
         	1 		Payload Data (DATA)
        2 to 127 	Reserved by the IETF
        128 to 255 	Reserved for IETF-Defined Transfer extensions

*   Message Length

    消息长度以字节为单位，包括公共报头和参数填充字节。

**Transfer Messages（Class）——Payload Data Message（Type）**

当Message Type为Payload Data Message时，包含以下参数：

    Network Appearance 		Optional（可选）
    Routing Context			Optional（可选）
    Protocol Data			Mandatory（强制）
    Correlation Id 			Optional（可选）

<img src="https://cokeice-pic.oss-cn-wulanchabu.aliyuncs.com/1693533734712.png" />

*   Protocol Data （变长）

    <img src="https://cokeice-pic.oss-cn-wulanchabu.aliyuncs.com/1693534105939.png" />

    \*SI（Service Indicator）：\*指定承载协议

        The values align with those provided in the SS7 MTP3 User Part Unavailable message and 'Service Indicator'. 
         0 to 2		Reserved
           3 		SCCP
           4 		TUP
           5 		ISUP
         6 to 8 	Reserved
           9 		Broadband ISUP
           10 		Satellite ISUP
           11 		Reserved
           12 		AAL type 2 Signalling
           13 		Bearer Independent Call Control (BICC)
           14 		Gateway Control Protocol
           15 		Reserved

## Example

    Frame 1: 342 bytes on wire (2736 bits), 342 bytes captured (2736 bits)
    Ethernet II, Src: Zhongxin_a1:78:5e (00:d0:d0:a1:78:5e), Dst: HuaweiTe_24:ac:32 (00:e0:fc:24:ac:32)
    Internet Protocol Version 4, Src: 192.168.189.100, Dst: 192.168.158.195
    Stream Control Transmission Protocol, Src Port: 8000 (8000), Dst Port: 7000 (7000)
        Source port: 8000
        Destination port: 7000
        Verification tag: 0x00003b0e
        [Association index: disabled (enable in preferences)]
        Checksum: 0x16653e0d [unverified]
        [Checksum Status: Unverified]
        DATA chunk (ordered, complete segment, TSN: 0, SID: 3, SSN: 10, PPID: 3, payload length: 280 bytes)
            Chunk type: DATA (0)
            Chunk flags: 0x03
            Chunk length: 296
            Transmission sequence number (relative): 0
            Transmission sequence number (absolute): 2289469076
            Stream identifier: 0x0003
            Stream sequence number: 10
            Payload protocol identifier: M3UA (3)
    MTP 3 User Adaptation Layer
        Version: Release 1 (1)
        Reserved: 0x00
        Message class: Transfer messages (1)
        Message Type: Payload data (DATA) (1)
        Message length: 280
        Routing context (1 context)
            Parameter Tag: Routing context (6)
            Parameter length: 8
            Routing context: 310
        Protocol data (SS7 message of 245 bytes)
            Parameter Tag: Protocol data (528)
            Parameter length: 261
            OPC: 329729
            DPC: 75781
            SI: BICC (13)
            NI: National network (2)
            MP: 0
            SLS: 2
            [MTP3 equivalents]
            Padding: 000000
    Bearer Independent Call Control(BICC)
    
    Frame 283: 94 bytes on wire (752 bits), 94 bytes captured (752 bits)
    Ethernet II, Src: ASUSTekC_e9:69:5c (00:0c:6e:e9:69:5c), Dst: Dell_e8:b8:fc (00:0d:56:e8:b8:fc)
    Internet Protocol Version 4, Src: 192.168.10.2, Dst: 192.168.10.3
    Stream Control Transmission Protocol, Src Port: 19400 (19400), Dst Port: 19400 (19400)
        Source port: 19400
        Destination port: 19400
        Verification tag: 0x00004823
        [Association index: disabled (enable in preferences)]
        Checksum: 0x5ab2794f [unverified]
        [Checksum Status: Unverified]
        DATA chunk (ordered, complete segment, TSN: 77, SID: 1, SSN: 75, PPID: 3, payload length: 32 bytes)
            Chunk type: DATA (0)
            Chunk flags: 0x03
            Chunk length: 48
            Transmission sequence number (relative): 77
            Transmission sequence number (absolute): 18544
            Stream identifier: 0x0001
            Stream sequence number: 75
            Payload protocol identifier: M3UA (3)
    MTP 3 User Adaptation Layer
        Version: Release 1 (1)
        Reserved: 0x00
        Message class: Transfer messages (1)
        Message Type: Payload data (DATA) (1)
        Message length: 32
        Protocol data (SS7 message of 5 bytes)
            Parameter Tag: Protocol data (528)
            Parameter length: 21
            OPC: 2
            DPC: 1
            SI: ISUP (5)
            NI: National network (2)
            MP: 0
            SLS: 0
            [MTP3 equivalents]
            Padding: 000000
    ISDN User Part(ISUP)

# BICC

BICC（Bearer Independent Call Control protocol）即与承载无关的呼叫控制协议。是在骨干网中使用的与承载无关的呼叫控制信令协议，通常用于2G和3G移动网络。

## 协议号

*   MTP3/M3UA：通常，BICC使用MTP3作为其传输协议。BICC使用的service indicator为**13**。

## 消息格式

<img src="https://cokeice-pic.oss-cn-wulanchabu.aliyuncs.com/image-20230830112416950.png" />

详细格式参考规范文件：`ITU-T Q.1902.3`

## Example

    Frame 1: 342 bytes on wire (2736 bits), 342 bytes captured (2736 bits)
    Ethernet II, Src: Zhongxin_a1:78:5e (00:d0:d0:a1:78:5e), Dst: HuaweiTe_24:ac:32 (00:e0:fc:24:ac:32)
    Internet Protocol Version 4, Src: 192.168.189.100, Dst: 192.168.158.195
    Stream Control Transmission Protocol, Src Port: 8000 (8000), Dst Port: 7000 (7000)
    MTP 3 User Adaptation Layer
        Version: Release 1 (1)
        Reserved: 0x00
        Message class: Transfer messages (1)
        Message Type: Payload data (DATA) (1)
        Message length: 280
        Routing context (1 context)
        Protocol data (SS7 message of 245 bytes)
            Parameter Tag: Protocol data (528)
            Parameter length: 261
            OPC: 329729
            DPC: 75781
            SI: BICC (13)
            NI: National network (2)
            MP: 0
            SLS: 2
            [MTP3 equivalents]
            Padding: 000000
    Bearer Independent Call Control
        CIC: 18
        Message Type: Initial address (1)
        Nature of Connection Indicators : 0x10
        Forward Call Indicators : 0x6001
        Calling Party's category : 0xa (ordinary calling subscriber)
        Transmission medium requirement : 0 (speech)
        Called Party Number: 8019
        Pointer to start of optional part: 6
        Parameter: (t=10, l=8): Calling party number: 13408000018F
        Parameter: (t=8, l=1): Optional forward call indicators : non-CUG call (128)
        Parameter: (t=29, l=3): User service information
        Parameter: (t=63, l=7): Location number: 8613400888
        Parameter: (t=120, l=198): Application transport
        End of optional parameters (0)

# ISUP

ISUP，即ISDN用户部分，是 SS7/C7 信令系统的一种主要协议，定义了协议和程序用于建立、管理和释放中继电路，该中继电路在公共交换电话网络（PSTN）上传输语音和数据呼叫。

## 协议号

*   MTP3/M3UA：通常，ISUP使用MTP3作为其传输协议。BICC使用的service indicator为**5**。

## 消息格式

<img src="https://cokeice-pic.oss-cn-wulanchabu.aliyuncs.com/image-20230901103214366.png" />

详细格式参考规范文件：`ITU-T Q.763`

## Example

```
Frame 283: 94 bytes on wire (752 bits), 94 bytes captured (752 bits)
Ethernet II, Src: ASUSTekC_e9:69:5c (00:0c:6e:e9:69:5c), Dst: Dell_e8:b8:fc (00:0d:56:e8:b8:fc)
Internet Protocol Version 4, Src: 192.168.10.2, Dst: 192.168.10.3
Stream Control Transmission Protocol, Src Port: 19400 (19400), Dst Port: 19400 (19400)
MTP 3 User Adaptation Layer
    Version: Release 1 (1)
    Reserved: 0x00
    Message class: Transfer messages (1)
    Message Type: Payload data (DATA) (1)
    Message length: 32
    Protocol data (SS7 message of 5 bytes)
        Parameter Tag: Protocol data (528)
        Parameter length: 21
        OPC: 2
        DPC: 1
        SI: ISUP (5)
        NI: National network (2)
        MP: 0
        SLS: 0
        [MTP3 equivalents]
        Padding: 000000
ISDN User Part
    CIC: 40
    Message Type: Answer (9)
    Pointer to start of optional part: 1
    End of optional parameters (0)

Frame 302: 94 bytes on wire (752 bits), 94 bytes captured (752 bits)
Ethernet II, Src: ASUSTekC_e9:69:5c (00:0c:6e:e9:69:5c), Dst: Dell_e8:b8:fc (00:0d:56:e8:b8:fc)
Internet Protocol Version 4, Src: 192.168.10.2, Dst: 192.168.10.3
Stream Control Transmission Protocol, Src Port: 19400 (19400), Dst Port: 19400 (19400)
MTP 3 User Adaptation Layer
    Version: Release 1 (1)
    Reserved: 0x00
    Message class: Transfer messages (1)
    Message Type: Payload data (DATA) (1)
    Message length: 32
    Protocol data (SS7 message of 7 bytes)
        Parameter Tag: Protocol data (528)
        Parameter length: 23
        OPC: 2
        DPC: 1
        SI: ISUP (5)
        NI: National network (2)
        MP: 0
        SLS: 0
        [MTP3 equivalents]
        Padding: 00
ISDN User Part
    CIC: 46
    Message Type: Address complete (6)
    Backward Call Indicators : 0x1614
    Pointer to start of optional part: 1
    End of optional parameters (0)

```

